<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cheryl Kouadio">
<meta name="author" content="Sous la supervision de : Fai√ßal HIHI">
<meta name="dcterms.date" content="2025-01-27">

<title>Asset management : Risques de liquidit√© (profil d‚Äô√©coulement / de liquidation d‚Äôun portefeuille d‚Äôactifs)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/logo-bg.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-79108a0fc1995748cbd19a5b0e3e3e7c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-fdf986989e2058d46a90f864900247d8.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/logo-bg.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index_stat.html"> 
<span class="menu-text">Mod√©lisation stat.</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index_gdr.html"> 
<span class="menu-text">Gestion des risques</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">√Ä propos</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sommaire</h2>
   
  <ul>
  <li><a href="#r√©cup√©ration-des-donn√©es" id="toc-r√©cup√©ration-des-donn√©es" class="nav-link active" data-scroll-target="#r√©cup√©ration-des-donn√©es">R√©cup√©ration des donn√©es</a></li>
  <li><a href="#pr√©sence-de-d√©formation" id="toc-pr√©sence-de-d√©formation" class="nav-link" data-scroll-target="#pr√©sence-de-d√©formation">Pr√©sence de d√©formation</a>
  <ul class="collapse">
  <li><a href="#sous-conditions-normales-avec-d√©formation-waterfall-liquidation" id="toc-sous-conditions-normales-avec-d√©formation-waterfall-liquidation" class="nav-link" data-scroll-target="#sous-conditions-normales-avec-d√©formation-waterfall-liquidation">Sous conditions normales avec d√©formation (waterfall liquidation)</a></li>
  <li><a href="#sous-conditions-stress√©es-avec-d√©formation" id="toc-sous-conditions-stress√©es-avec-d√©formation" class="nav-link" data-scroll-target="#sous-conditions-stress√©es-avec-d√©formation">Sous conditions stress√©es avec d√©formation</a></li>
  </ul></li>
  <li><a href="#absence-de-d√©formation-du-portefeuille-pro-forma" id="toc-absence-de-d√©formation-du-portefeuille-pro-forma" class="nav-link" data-scroll-target="#absence-de-d√©formation-du-portefeuille-pro-forma">Absence de d√©formation du portefeuille (pro forma)</a>
  <ul class="collapse">
  <li><a href="#sous-condition-normale-sans-d√©formation" id="toc-sous-condition-normale-sans-d√©formation" class="nav-link" data-scroll-target="#sous-condition-normale-sans-d√©formation">Sous condition normale sans d√©formation</a></li>
  <li><a href="#sous-conditions-stress√©es-sans-d√©formation" id="toc-sous-conditions-stress√©es-sans-d√©formation" class="nav-link" data-scroll-target="#sous-conditions-stress√©es-sans-d√©formation">Sous conditions stress√©es sans d√©formation</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="TP-2.ipynb" download="TP-2.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Asset management : Risques de liquidit√© (profil d‚Äô√©coulement / de liquidation d‚Äôun portefeuille d‚Äôactifs)</h1>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Cheryl Kouadio </p>
             <p>Sous la supervision de : Fai√ßal HIHI </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 27, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Le risque de liquidit√© est l‚Äôune des quatre grandes cat√©gories de risques auxquels une banque peut √™tre expos√©e. Il concerne √† la fois la liquidit√© du march√© et le risque op√©rationnel de financement.</p>
<ul>
<li>La liquidit√© du march√© fait r√©f√©rence √† la capacit√© d‚Äôun investisseur √† acheter ou vendre un actif sans en affecter significativement le prix.</li>
<li>Le risque op√©rationnel de financement concerne la capacit√© √† lever des fonds pour financer ses activit√©s.</li>
</ul>
<p>Ainsi, le risque de liquidit√© est crucial dans la gestion d‚Äôun portefeuille, notamment en p√©riode de tensions sur les march√©s. Si un investisseur doit liquider un actif, il peut √™tre contraint de le vendre √† un prix inf√©rieur √† sa valeur fondamentale, entra√Ænant ainsi une perte importante.</p>
<p>Pour √©valuer ce risque, plusieurs indicateurs sont utilis√©s : - le co√ªt de liquidit√©, - le profil d‚Äô√©coulement (ou profil de liquidation), - les gaps de liquidit√©, - les stress tests de liquidit√©.</p>
<p>Dans le cadre de notre √©tude, nous nous concentrons sur le profil d‚Äô√©coulement d‚Äôun portefeuille compos√© de 10 actifs, et ce dans les quatre sc√©narios suivants :</p>
<p><strong>1. Conditions normales avec d√©formation :</strong> On consid√®re les volumes moyens de march√©, que l‚Äôon d√©forme pour obtenir les quantit√©s effectivement liquid√©es.<br>
La liquidation d√©bute avec les actifs les plus liquides et se termine avec les plus illiquides.<br>
Ce processus entra√Æne une d√©formation du portefeuille :<br>
les premiers investisseurs r√©cup√®rent une part plus liquide, tandis que ceux qui restent se retrouvent avec des actifs plus illiquides.</p>
<p><strong>2. Conditions normales sans d√©formation :</strong> Dans ce cas, on cherche √† pr√©server l‚Äô√©quilibre du portefeuille, afin de ne pas p√©naliser les investisseurs restants.<br>
La liquidation est r√©partie uniform√©ment, sans privil√©gier les actifs les plus liquides.</p>
<p><strong>3. Conditions stress√©es avec d√©formation :</strong> Les march√©s sont en tension, les volumes chutent drastiquement.<br>
On liquide en priorit√© les actifs les plus liquides, ce qui accentue l‚Äôilliquidit√© r√©siduelle du portefeuille.</p>
<p><strong>4. Conditions stress√©es sans d√©formation :</strong> M√™me en p√©riode de stress, on cherche √† conserver une proportionnalit√© √©quitable dans la liquidation, pour √©viter une concentration d‚Äôactifs illiquides pour les investisseurs restants.</p>
<p><strong>√âtapes de mise en ≈ìuvre</strong></p>
<p>Pour chaque sc√©nario, on proc√®de selon les √©tapes suivantes :</p>
<ol type="1">
<li><p>R√©cup√©ration des volumes journaliers sur une p√©riode historique de 3 mois, √† compter de la date d‚Äôaujourd‚Äôhui, i.e.&nbsp;le 28 mars 2025.</p></li>
<li><p>Calcul de l‚ÄôADV sur 3 mois <em>(Average Daily Volume)</em> :<br>
<span class="math display">\[
\text{ADV}_{T=3M} = \frac{1}{T} \sum_{t=1}^{T} V_t,
\]</span></p>
<p>o√π <span class="math inline">\(V_t\)</span> est le volume quotidien et <span class="math inline">\(T\)</span> le nombre de jours ouvr√©s sur les 3 mois.</p></li>
<li><p>G√©n√©ration des quantit√©s associ√©es √† chaque actif dans le portefeuille.</p></li>
<li><p>Pour obtenir un portefeuille ni trop liquide, ni trop illiquide, on applique la formule : <span class="math display">\[
Q_i = 1.5 \times \text{randn}() \times \text{ADV}_{3M}^{(i)},
\]</span></p>
<p>o√π <span class="math inline">\(\text{randn}() \sim \mathcal{U}[0, 1]\)</span> est une variable al√©atoire uniforme, et <span class="math inline">\(\text{ADV}_{3M}^{(i)}\)</span> l‚ÄôADV de l‚Äôactif <span class="math inline">\(i\)</span>.</p></li>
<li><p>Calcul du profil de liquidation : Ce profil est construit en fonction de la quantit√© liquid√©e chaque jour, en tenant compte de la limite fix√©e par le volume moyen quotidien de chaque actif.</p></li>
</ol>
<p>Nous utiliserons un portefeuille fictif de 10 actifs du CAC, √† savoir : - Sanofi - Societe Generale - Thales - Engie - Capgemini - Carrefour - Orange - Accor - L‚ÄôOreal - Cr√©dit agricole</p>
<section id="r√©cup√©ration-des-donn√©es" class="level3">
<h3 class="anchored" data-anchor-id="r√©cup√©ration-des-donn√©es">R√©cup√©ration des donn√©es</h3>
<div id="891f1d13" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------#</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------- Package Imports ---------#</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------#</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="83ff6db8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_data(start_date, end_date, index_ticker, tickers, column<span class="op">=</span><span class="st">"Close"</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Extraction de prix de cl√¥ture d'actions</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraction des volumes historiques des composants</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> yf.download(tickers, start<span class="op">=</span>start_date, end<span class="op">=</span>end_date, auto_adjust <span class="op">=</span><span class="va">True</span>)[column]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraction des volumes historiques de l'indice de ref√©rence</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> yf.download(index_ticker, start<span class="op">=</span>start_date, end<span class="op">=</span>end_date, auto_adjust <span class="op">=</span><span class="va">True</span>)[column]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"portfolio_data"</span>: data,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"benchmark_data"</span>: index,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> datetime.now()</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> end_date <span class="op">-</span> timedelta(days<span class="op">=</span><span class="dv">3</span><span class="op">*</span><span class="dv">31</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>selected_assets <span class="op">=</span> {</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAN.PA"</span> : <span class="st">"Sanofi"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GLE.PA"</span> : <span class="st">"Soci√©t√© g√©n√©rale"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HO.PA"</span> : <span class="st">"Thales"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ENGI.PA"</span> : <span class="st">"Engie"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CAP.PA"</span> : <span class="st">"Capgemini"</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CA.PA"</span> : <span class="st">"Carrefour"</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ORA.PA"</span> : <span class="st">"Orange"</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AC.PA"</span> : <span class="st">"Accor"</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OR.PA"</span> : <span class="st">"L'Oreal"</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ACA.PA"</span> : <span class="st">"Cr√©dit agricole"</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="st">"^FCHI"</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>assets_ticker  <span class="op">=</span> <span class="bu">list</span>(selected_assets.keys())</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> get_data(start_date,end_date, index, assets_ticker, column<span class="op">=</span><span class="st">"Volume"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][**********************80%*************          ]  8 of 10 completed[**********************90%******************     ]  9 of 10 completed[*********************100%***********************]  10 of 10 completed
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="b2223ffc" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>portfolio_data <span class="op">=</span> data[<span class="st">"portfolio_data"</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>portfolio_data.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">AC.PA</th>
<th data-quarto-table-cell-role="th">ACA.PA</th>
<th data-quarto-table-cell-role="th">CA.PA</th>
<th data-quarto-table-cell-role="th">CAP.PA</th>
<th data-quarto-table-cell-role="th">ENGI.PA</th>
<th data-quarto-table-cell-role="th">GLE.PA</th>
<th data-quarto-table-cell-role="th">HO.PA</th>
<th data-quarto-table-cell-role="th">OR.PA</th>
<th data-quarto-table-cell-role="th">ORA.PA</th>
<th data-quarto-table-cell-role="th">SAN.PA</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2025-03-24</td>
<td>730382</td>
<td>5071701</td>
<td>3617903</td>
<td>534016</td>
<td>5262159</td>
<td>2127625</td>
<td>371968</td>
<td>411521</td>
<td>7155931</td>
<td>1913393</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2025-03-25</td>
<td>562409</td>
<td>6524905</td>
<td>2255242</td>
<td>558654</td>
<td>5809793</td>
<td>2587026</td>
<td>321188</td>
<td>353058</td>
<td>6643361</td>
<td>2079709</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2025-03-26</td>
<td>655970</td>
<td>4275680</td>
<td>1989898</td>
<td>570364</td>
<td>5282143</td>
<td>2412206</td>
<td>300659</td>
<td>415637</td>
<td>7164082</td>
<td>2056619</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2025-03-27</td>
<td>654205</td>
<td>4746013</td>
<td>2208609</td>
<td>560011</td>
<td>6384021</td>
<td>3124962</td>
<td>317644</td>
<td>371877</td>
<td>7035243</td>
<td>1645925</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2025-03-28</td>
<td>973322</td>
<td>5792588</td>
<td>2671535</td>
<td>465431</td>
<td>5227544</td>
<td>2992606</td>
<td>298259</td>
<td>418671</td>
<td>5970202</td>
<td>2141022</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>L‚ÄôAverage Daily Volume (ADV) ou ATV (Average Traded Volume) est un indicateur cl√© en finance, qui permet de mesurer la liquidit√© d‚Äôun actif. Il est calcul√© en prenant la moyenne des volumes √©chang√©s sur une p√©riode donn√©e. Plus l‚ÄôADV est √©lev√©, plus l‚Äôactif est liquide, et plus il est facile de le vendre sans impacter le prix du march√©.</p>
<p>En g√©n√©ral, c‚Äôest l‚ÄôADV sur 3 mois qui est utilis√©, car il permet de lisser les variations quotidiennes et de donner une vision plus pr√©cise de la liquidit√© d‚Äôun actif.</p>
<p><span class="math display">\[ADV = \frac{\sum_{i=1}^{n} V_i}{n},\]</span></p>
<p>o√π <span class="math inline">\(V_i\)</span> est le volume √©chang√© le jour <span class="math inline">\(i\)</span>, et <span class="math inline">\(n\)</span> est le nombre de jours sur la p√©riode consid√©r√©e.</p>
<p>Dans le code ci-dessous, nous avons calcul√© l‚ÄôADV sur 3 mois pour chaque actif du portefeuille. Nous constatons que l‚Äôactif le plus liquide est <strong>Orange</strong>, avec un ADV d‚Äôenviron 7,7 million d‚Äôactions √©chang√©es par jour, tandis que l‚Äôactif le moins liquide est <strong>Thales</strong>, avec un ADV d‚Äôenviron 0,4 million d‚Äôactions √©chang√©es par jour. De ce fait, durant ces trois mois, l‚Äôaction Orange a √©t√© plus plus liquide que l‚Äôaction Thales.</p>
<div id="d863552d" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------#</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul des ADV 3Mois#</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------#</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>adv_3m <span class="op">=</span> {ticker : np.mean(portfolio_data[ticker]) <span class="cf">for</span> ticker <span class="kw">in</span> assets_ticker}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>adv_3m</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>ADV <span class="op">=</span> pd.DataFrame.from_dict(adv_3m, orient<span class="op">=</span><span class="st">'index'</span>, columns<span class="op">=</span>[<span class="st">'ADV'</span>])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># trier par ADV</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>ADV.sort_values(by<span class="op">=</span><span class="st">'ADV'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ADV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>7.681298e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>6.942001e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>6.072020e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>3.524290e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>3.008415e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1.827452e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>6.501683e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>5.081382e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>4.590586e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>3.903374e+05</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Pour g√©n√©rer le volume d√©tenu dans notre portefeuille, nous allons utiliser la formule suivante :</p>
<p><span class="math display">\[
\text{Volume d√©tenu} = 1.5 \times \text{randn()} \times \text{ADV 3M}
\]</span></p>
<p>Cette formule sert √† simuler un portefeuille r√©aliste o√π les tailles de position sont ajust√©es √† la liquidit√© de chaque actif, avec une variabilit√© al√©atoire ma√Ætris√©e. Elle est simple, mais tr√®s utile pour tester des hypoth√®ses de liquidation, de stress, ou de concentration.</p>
<div id="630d1816" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># G√©n√©ration des quantit√©s</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ADV[<span class="st">"Quantity"</span>] <span class="op">=</span>  <span class="bu">round</span>(<span class="fl">1.5</span> <span class="op">*</span> np.random.rand(<span class="bu">len</span>(ADV[<span class="st">"ADV"</span>])) <span class="op">*</span> ADV[<span class="st">"ADV"</span>])</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ADV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ADV</th>
<th data-quarto-table-cell-role="th">Quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1.827452e+06</td>
<td>1909146.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>3.524290e+06</td>
<td>1512657.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>3.903374e+05</td>
<td>132823.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>6.072020e+06</td>
<td>5021391.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>5.081382e+05</td>
<td>548385.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>3.008415e+06</td>
<td>1909319.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>7.681298e+06</td>
<td>11300313.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>6.501683e+05</td>
<td>667882.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>4.590586e+05</td>
<td>331164.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>6.942001e+06</td>
<td>4083121.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>En plus de la g√©n√©ration des quantit√©s, il est utile de connaitre la quantit√© qu‚Äôon peut liquider en une journ√©e. En effet, la liquidit√© d‚Äôun actif n‚Äôest pas infinie, et il est important de savoir combien on peut vendre sans impacter le prix de mani√®re significative. Pour cela, on utilise la notion de profondeur de march√©.</p>
<p>La profondeur de march√© est une quantit√© √† partir de laquelle on ne peut plus vendre sans impacter le prix de fa√ßon consid√©rable. On fait l‚Äôhypoth√®se que la profondeur de march√© est de 20%. Cela signifie que l‚Äôon peut vendre 20% de la quantit√© sans impacter le prix de fa√ßon consid√©rable. Au-del√†, le prix est impact√©. Cette profondeur est ce qui est observ√© en pratique dans les carnets d‚Äôordre √† tel point que l‚ÄôAMF le recommande.</p>
<p>A l‚Äôaide de cette profondeur de march√©, on peut d√©terminer la quantit√© liquidable en une journ√©e de la mani√®re suivante : <span class="math display">\[
ADV 3M \times 0.2
\]</span></p>
<p>Le nombre de jours de liquidation peut √™tre ainsi d√©termin√© : <span class="math display">\[
\frac{\text{Quantit√© √† liquider}}{\text{Quantit√© liquidable en une journ√©e}}
\]</span></p>
<p>Ce nombre de jours est g√©n√©ralement arrondi √† l‚Äôentier sup√©rieur et floor√© √† 1. Plus ce nombre est √©lev√©, plus la liquidation sera longue, et plus le risque de march√© sera √©lev√©. En effet, plus la liquidation est longue, plus le risque de march√© est √©lev√©, car il y a plus de chances que le prix de l‚Äôactif √©volue entre le moment o√π l‚Äôinvestisseur d√©cide de liquider et le moment o√π la liquidation est termin√©e.</p>
<div id="45282566" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantit√© liquidable en 1 jour</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>market_depth <span class="op">=</span> <span class="dv">20</span><span class="op">/</span><span class="dv">100</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>ADV[<span class="st">"Quantity in 1day"</span>] <span class="op">=</span> <span class="bu">round</span>(ADV[<span class="st">"ADV"</span>] <span class="op">*</span> market_depth)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul du nombre de jours de liquidation</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>ADV[<span class="st">"Days of liquidation"</span>] <span class="op">=</span> ADV[<span class="st">"Quantity"</span>]<span class="op">/</span>ADV[<span class="st">"Quantity in 1day"</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># floor to 1 and round</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>ADV[<span class="st">"Days of liquidation"</span>] <span class="op">=</span> ADV[<span class="st">"Days of liquidation"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">max</span>(<span class="dv">1</span>, <span class="bu">round</span>(x)))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>ADV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ADV</th>
<th data-quarto-table-cell-role="th">Quantity</th>
<th data-quarto-table-cell-role="th">Quantity in 1day</th>
<th data-quarto-table-cell-role="th">Days of liquidation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1.827452e+06</td>
<td>1909146.0</td>
<td>365490.0</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>3.524290e+06</td>
<td>1512657.0</td>
<td>704858.0</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>3.903374e+05</td>
<td>132823.0</td>
<td>78067.0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>6.072020e+06</td>
<td>5021391.0</td>
<td>1214404.0</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>5.081382e+05</td>
<td>548385.0</td>
<td>101628.0</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>3.008415e+06</td>
<td>1909319.0</td>
<td>601683.0</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>7.681298e+06</td>
<td>11300313.0</td>
<td>1536260.0</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>6.501683e+05</td>
<td>667882.0</td>
<td>130034.0</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>4.590586e+05</td>
<td>331164.0</td>
<td>91812.0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>6.942001e+06</td>
<td>4083121.0</td>
<td>1388400.0</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="169715d6" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>time_elapsed <span class="op">=</span> ADV[<span class="st">'Days of liquidation'</span>].<span class="bu">max</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temps de liquidation du portefeuille : </span><span class="sc">{</span>time_elapsed<span class="sc">}</span><span class="ss"> jours"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 7 jours</code></pre>
</div>
</div>
<p>En calcucant le nombre de jours de liquidation pour chaque actif, on constate que les actifs qui se liquide le plus vite sont les actifs Thales et Soci√©t√© G√©n√©rale. L‚Äôactif qui quant √† lui prend le plus de temps √† se liquider est l‚Äôactif Orange. Cela peut sembler paradoxal, car Orange est l‚Äôactif le plus liquide,compte tenu de son ADV. Cependant, cela s‚Äôexplique par le fait que la quantit√© √† liquider est d√©pendante de l‚ÄôADV, et est de ce fait tr√®s importante, et que la profondeur de march√© est faible. En effet, m√™me si l‚ÄôADV est √©lev√©, la profondeur de march√© est faible, ce qui rend la liquidation plus difficile. Un actif avec un petit ADV peut se liquider plus vite simplement parce qu‚Äôon lui aura affect√© d‚Äôun petit coefficient al√©atoire, dans la g√©n√©ration des quantit√©s initiales.</p>
<blockquote class="blockquote">
<p>üí° La liquidit√© d‚Äôun portefeuille d√©pend de la liquidit√© intrins√®que des titres et la quantit√© de titres.</p>
</blockquote>
</section>
<section id="pr√©sence-de-d√©formation" class="level2">
<h2 class="anchored" data-anchor-id="pr√©sence-de-d√©formation">Pr√©sence de d√©formation</h2>
<p>La d√©formation dans le cadre de la liquidation d‚Äôun portefeuille d‚Äôactifs fait r√©f√©rence √† la mani√®re dont les quantit√©s liquid√©es sont r√©parties entre les diff√©rents actifs du portefeuille. En effet, lorsque l‚Äôon liquide un portefeuille, on ne peut pas simplement vendre tous les actifs en m√™me temps, compte tenu de leur liquidit√© respective. La d√©formation se produit lorsque l‚Äôon liquide d‚Äôabord les actifs les plus liquides, ce qui entra√Æne une concentration d‚Äôactifs illiquides dans le portefeuille restant. Cela peut avoir un impact significatif sur la valeur du portefeuille et sur le risque de liquidit√©.</p>
<section id="sous-conditions-normales-avec-d√©formation-waterfall-liquidation" class="level3">
<h3 class="anchored" data-anchor-id="sous-conditions-normales-avec-d√©formation-waterfall-liquidation">Sous conditions normales avec d√©formation (waterfall liquidation)</h3>
<p>Pour conna√Ætre la quantit√© d‚Äôactifs liquid√©s chaque jour, on fait l‚Äôhypoth√®se que les liquidations futures se feront aux prix observ√©s aujourd‚Äôhui. En pratique, ce que l‚Äôon peut r√©ellement liquider en une journ√©e correspond √† la quantit√© que l‚Äôon peut vendre sans impacter le prix, c‚Äôest-√†-dire min(quantit√© liquidable en 1 jour, quantit√© restant dans le portefeuille).</p>
<p>Sur cette base, on peut calculer la valeur de march√© du portefeuille, aussi bien au moment initial qu‚Äô√† chaque jour de liquidation. Cette valeur est g√©n√©ralement exprim√©e en pourcentage de l‚Äôencours total.</p>
<p>On peut ensuite calculer le cumul des pourcentages liquid√©s au fil des jours. Cette courbe cumulative repr√©sente ce que l‚Äôon appelle le profil d‚Äô√©coulement du portefeuille.</p>
<p>Dans le code ci-dessous, nous pr√©sentons les quantit√©s liquid√©es par jour pour chaque actif.</p>
<blockquote class="blockquote">
<p>üí° Par convention, le jour 0 correspond √† la quantit√© initialement d√©tenue dans le portefeuille, avant toute op√©ration de liquidation.</p>
</blockquote>
<div id="dc38ecb7" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------#</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Liquidation du portefeuille</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------#</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>ADV[<span class="st">"Quantity liquidated"</span>] <span class="op">=</span> <span class="dv">0</span>  <span class="co"># Initialement, rien n'est liquid√©</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Au jour 0, on a liquid√© 0. La colonne 0 sert de quantit√© initiale</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>quantity_liquidated_per_day <span class="op">=</span> [ADV[<span class="st">"Quantity"</span>]]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (ADV[<span class="st">"Quantity"</span>] <span class="op">-</span> ADV[<span class="st">"Quantity liquidated"</span>]).<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span> : <span class="co"># Tant qu'il y a des liquidations √† faire</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculer la quantit√© liquide au jour i</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    liquidated_today <span class="op">=</span> np.minimum(ADV[<span class="st">"Quantity in 1day"</span>], ADV[<span class="st">"Quantity"</span>] <span class="op">-</span> ADV[<span class="st">"Quantity liquidated"</span>])</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mettre √† jour les quantit√©s liquid√©es dans le DataFrame</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    ADV[<span class="st">"Quantity liquidated"</span>] <span class="op">+=</span> liquidated_today</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stocker les quantit√©s liquid√©es ce jour dans une liste</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    quantity_liquidated_per_day.append(liquidated_today)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>liquidation_df <span class="op">=</span> pd.DataFrame(quantity_liquidated_per_day).T</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>liquidation_df.columns <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(quantity_liquidated_per_day))]</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>liquidation_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1909146.0</td>
<td>365490.0</td>
<td>365490.0</td>
<td>365490.0</td>
<td>365490.0</td>
<td>365490.0</td>
<td>81696.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>1512657.0</td>
<td>704858.0</td>
<td>704858.0</td>
<td>102941.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>132823.0</td>
<td>78067.0</td>
<td>54756.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>5021391.0</td>
<td>1214404.0</td>
<td>1214404.0</td>
<td>1214404.0</td>
<td>1214404.0</td>
<td>163775.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>548385.0</td>
<td>101628.0</td>
<td>101628.0</td>
<td>101628.0</td>
<td>101628.0</td>
<td>101628.0</td>
<td>40245.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>1909319.0</td>
<td>601683.0</td>
<td>601683.0</td>
<td>601683.0</td>
<td>104270.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>11300313.0</td>
<td>1536260.0</td>
<td>1536260.0</td>
<td>1536260.0</td>
<td>1536260.0</td>
<td>1536260.0</td>
<td>1536260.0</td>
<td>1536260.0</td>
<td>546493.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>667882.0</td>
<td>130034.0</td>
<td>130034.0</td>
<td>130034.0</td>
<td>130034.0</td>
<td>130034.0</td>
<td>17712.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>331164.0</td>
<td>91812.0</td>
<td>91812.0</td>
<td>91812.0</td>
<td>55728.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>4083121.0</td>
<td>1388400.0</td>
<td>1388400.0</td>
<td>1306321.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="c8558629" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> datetime.now()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> end_date <span class="op">-</span> timedelta(days<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>price_data <span class="op">=</span> get_data(start_date, end_date, index, assets_ticker, column<span class="op">=</span><span class="st">"Close"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>price_data[<span class="st">"portfolio_data"</span>].head()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>price_dict <span class="op">=</span> price_data[<span class="st">"portfolio_data"</span>].iloc[<span class="op">-</span><span class="dv">1</span>].to_dict()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Prix des actifs √† la date du jour"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ticker, price <span class="kw">in</span> price_dict.items():</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Le prix de l'actif </span><span class="sc">{</span>selected_assets[ticker]<span class="sc">}</span><span class="ss"> est de </span><span class="sc">{</span>price<span class="sc">}</span><span class="ss"> ‚Ç¨"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[                       0%                       ][**********            20%                       ]  2 of 10 completed[**************        30%                       ]  3 of 10 completed[*******************   40%                       ]  4 of 10 completed[**********************50%                       ]  5 of 10 completed[**********************50%                       ]  5 of 10 completed[**********************50%                       ]  5 of 10 completed[**********************80%*************          ]  8 of 10 completed[**********************80%*************          ]  8 of 10 completed[*********************100%***********************]  10 of 10 completed
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
Prix des actifs √† la date du jour
==================================================
Le prix de l'actif Accor est de 42.790000915527344 ‚Ç¨
Le prix de l'actif Cr√©dit agricole est de 16.94499969482422 ‚Ç¨
Le prix de l'actif Carrefour est de 13.255000114440918 ‚Ç¨
Le prix de l'actif Capgemini est de 145.3000030517578 ‚Ç¨
Le prix de l'actif Engie est de 18.059999465942383 ‚Ç¨
Le prix de l'actif Soci√©t√© g√©n√©rale est de 42.540000915527344 ‚Ç¨
Le prix de l'actif Thales est de 246.60000610351562 ‚Ç¨
Le prix de l'actif L'Oreal est de 345.1000061035156 ‚Ç¨
Le prix de l'actif Orange est de 11.850000381469727 ‚Ç¨
Le prix de l'actif Sanofi est de 103.4000015258789 ‚Ç¨</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
</div>
<div id="0d9f1a78" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeur liquide des actions par jour de liquidation</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>market_value <span class="op">=</span>[</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    price_dict[ticker] <span class="op">*</span> liquidation_df.loc[ticker]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ticker <span class="kw">in</span> selected_assets</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>market_value <span class="op">=</span> pd.DataFrame(market_value, index<span class="op">=</span>selected_assets, columns<span class="op">=</span>liquidation_df.columns)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>market_value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1.974057e+08</td>
<td>3.779167e+07</td>
<td>3.779167e+07</td>
<td>3.779167e+07</td>
<td>3.779167e+07</td>
<td>3.779167e+07</td>
<td>8.447367e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>6.434843e+07</td>
<td>2.998466e+07</td>
<td>2.998466e+07</td>
<td>4.379110e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>3.275415e+07</td>
<td>1.925132e+07</td>
<td>1.350283e+07</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>9.068632e+07</td>
<td>2.193214e+07</td>
<td>2.193214e+07</td>
<td>2.193214e+07</td>
<td>2.193214e+07</td>
<td>2.957776e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>7.968034e+07</td>
<td>1.476655e+07</td>
<td>1.476655e+07</td>
<td>1.476655e+07</td>
<td>1.476655e+07</td>
<td>1.476655e+07</td>
<td>5.847599e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>2.530802e+07</td>
<td>7.975308e+06</td>
<td>7.975308e+06</td>
<td>7.975308e+06</td>
<td>1.382099e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>1.339087e+08</td>
<td>1.820468e+07</td>
<td>1.820468e+07</td>
<td>1.820468e+07</td>
<td>1.820468e+07</td>
<td>1.820468e+07</td>
<td>1.820468e+07</td>
<td>1.820468e+07</td>
<td>6.475942e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>2.857867e+07</td>
<td>5.564155e+06</td>
<td>5.564155e+06</td>
<td>5.564155e+06</td>
<td>5.564155e+06</td>
<td>5.564155e+06</td>
<td>7.578965e+05</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>1.142847e+08</td>
<td>3.168432e+07</td>
<td>3.168432e+07</td>
<td>3.168432e+07</td>
<td>1.923173e+07</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>6.918848e+07</td>
<td>2.352644e+07</td>
<td>2.352644e+07</td>
<td>2.213561e+07</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="940ab7af" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul de la valeur de march√© initiale et totale</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>market_value_0 <span class="op">=</span> market_value.iloc[:, <span class="dv">0</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>total_market_value_0 <span class="op">=</span> market_value_0.<span class="bu">sum</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f" La valeur de march√© initiale est de </span><span class="sc">{</span>total_market_value_0<span class="sc">}</span><span class="ss">‚Ç¨"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>cumsum_market_value <span class="op">=</span> market_value.iloc[:, <span class="dv">1</span>:].cumsum(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>cumsum_total_market_value <span class="op">=</span> market_value.iloc[:, <span class="dv">1</span>:].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).cumsum()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>cumsum_market_value <span class="op">=</span> pd.concat([pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>market_value.index, columns<span class="op">=</span>[<span class="dv">0</span>]), cumsum_market_value], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>cumsum_total_market_value <span class="op">=</span> pd.concat([pd.Series(<span class="dv">0</span>, index<span class="op">=</span>[<span class="dv">0</span>]), cumsum_total_market_value])</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> {}</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ticker <span class="kw">in</span> assets_ticker :</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    weights[ticker] <span class="op">=</span> (market_value_0.loc[ticker] <span class="op">-</span> cumsum_market_value.loc[ticker]) <span class="op">/</span> (total_market_value_0 <span class="op">-</span> cumsum_total_market_value)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> pd.DataFrame(weights).T</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>weights.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> La valeur de march√© initiale est de 836143533.8764086‚Ç¨</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>0.236091</td>
<td>0.255194</td>
<td>0.289688</td>
<td>0.328122</td>
<td>0.336963</td>
<td>0.145800</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>0.076959</td>
<td>0.054941</td>
<td>0.010413</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>0.039173</td>
<td>0.021589</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>0.108458</td>
<td>0.109925</td>
<td>0.111341</td>
<td>0.097190</td>
<td>0.021555</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>0.095295</td>
<td>0.103785</td>
<td>0.119248</td>
<td>0.138154</td>
<td>0.150224</td>
<td>0.100928</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="6d364d06" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot empil√©</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> asset <span class="kw">in</span> weights.index:</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    plt.bar(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        pd.to_numeric(weights.columns),  </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        weights.loc[asset],  </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        bottom<span class="op">=</span>bottom,  </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>selected_assets[asset]  </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">=</span> weights.loc[asset] <span class="cf">if</span> bottom <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> bottom <span class="op">+</span> weights.loc[asset]</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Days of Liquidation"</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Portfolio Weights"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"D√©formation du portefeuille"</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"Assets"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">"upper left"</span>, fontsize<span class="op">=</span><span class="dv">8</span>, ncol<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-13-output-1.png" width="1138" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nous constatons avec ce profile de liquidation que les actifs les plus liquides sont liquid√©s en premier, ce qui entra√Æne une concentration d‚Äôactifs illiquides dans le portefeuille restant. Cela peut avoir un impact significatif sur la valeur du portefeuille et sur le risque de liquidit√©. En effet, √† la fin de la p√©riode de liquidation, le portefeuille est uniquement constitu√© de l‚Äôactif Orange, qui nous avons vu pr√©c√©demment est l‚Äôactif le plus illiquide.</p>
<blockquote class="blockquote">
üí° Bon √† savoir : Pour un fonds de droit fran√ßais r√©glement√©, il est interdit d‚Äôinvestir plus de 5‚ÄØ% du portefeuille dans un seul √©metteur. Cependant, √† titre exceptionnel, il est possible d‚Äôinvestir jusqu‚Äô√† 10‚ÄØ% dans certains titres, √† condition que la somme des expositions sup√©rieures √† 5‚ÄØ% ne d√©passe pas 40‚ÄØ% du portefeuille. C‚Äôest ce que l‚Äôon appelle la r√®gle des 5/10/40, un ratio r√©glementaire applicable aux OPC (organismes de placement collectif). Toutes les pertes li√©es √† un non-respect de ce ratio doivent √™tre support√©es par la soci√©t√© de gestion. De plus, tout d√©passement doit √™tre d√©clar√© √† l‚ÄôAMF.
</blockquote>
<div id="1e2a7006" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeur liquide du portefeuille</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>market_value_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>market_value_df[<span class="st">"market_value"</span>] <span class="op">=</span> market_value.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer la valeur liquide relative par rapport au jour 0</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>market_value_df[<span class="st">"relative value"</span>] <span class="op">=</span> market_value_df[<span class="st">"market_value"</span>] <span class="op">/</span> market_value_df[<span class="st">"market_value"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer la valeur cumul√©e liquide relative du portefeuille</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>market_value_df[<span class="st">"cumulative value"</span>] <span class="op">=</span> market_value_df[<span class="st">"relative value"</span>].cumsum() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>market_value_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">market_value</th>
<th data-quarto-table-cell-role="th">relative value</th>
<th data-quarto-table-cell-role="th">cumulative value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8.361435e+08</td>
<td>1.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.106812e+08</td>
<td>0.251968</td>
<td>0.251968</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.049327e+08</td>
<td>0.245093</td>
<td>0.497061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.644335e+08</td>
<td>0.196657</td>
<td>0.693718</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.188730e+08</td>
<td>0.142168</td>
<td>0.835886</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>7.928483e+07</td>
<td>0.094822</td>
<td>0.930708</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>3.325754e+07</td>
<td>0.039775</td>
<td>0.970483</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1.820468e+07</td>
<td>0.021772</td>
<td>0.992255</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>6.475942e+06</td>
<td>0.007745</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="70980370" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>market_value_df <span class="op">=</span> market_value_df.iloc[<span class="dv">1</span>:]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> plt.bar(market_value_df.index, market_value_df[<span class="st">"cumulative value"</span>] <span class="op">*</span> <span class="dv">100</span>, color<span class="op">=</span><span class="st">"skyblue"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> bar.get_height()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    plt.text(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        bar.get_x() <span class="op">+</span> bar.get_width() <span class="op">/</span> <span class="dv">2</span>,  <span class="co"># Center text</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        height,  <span class="co"># Position slightly above the bar</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f'</span><span class="sc">{</span>height<span class="sc">:.2f}</span><span class="ss">'</span>,  <span class="co"># Format with 2 decimal places</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        ha<span class="op">=</span><span class="st">'center'</span>,  <span class="co"># Center horizontally</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        va<span class="op">=</span><span class="st">'bottom'</span>,  <span class="co"># Position text at the bottom</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Days"</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Cumulative Value (%)"</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Profil de liquidation du portefeuille"</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-15-output-1.png" width="965" height="526" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Pour voir ce qui arrive au profil d‚Äô√©coulement lorsque les quantit√©s varient, on va utiliser un facteur de modulation de la quantit√©. Cela permet de d√©terminer quelle est la taille cible du portefeuille qui permet d‚Äôavoir la liquidit√© pour un certain niveau en nombre de jours qu‚Äôon se fixe. Cet exercice est fait une seule fois √† l‚Äôinitialisation du portefeuille.</p>
<p>Pour facilier l‚Äôimpl√©mentation, nous allons utiliser une fonction <code>liquidation_profile</code> qui va nous permettre de calculer le profil d‚Äô√©coulement du portefeuille, en int√©grant le facteur de modulation. Lorsqu‚Äôon ne souhaite pas de modulation, on peut simplement passer un facteur de modulation de 1.</p>
<div id="87ca3ef2" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> waterfall_liquidation(ADV, price_dict, selected_assets, fact_modulation<span class="op">=</span><span class="fl">0.30</span>, plot_graphs<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calcule le profil de liquidation et visualise les graphiques des poids et des valeurs cumul√©es.</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation des quantit√©s liquid√©es</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    ADV <span class="op">=</span> ADV.copy()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    ADV[<span class="st">"Quantity"</span>] <span class="op">=</span> <span class="bu">round</span>(ADV[<span class="st">"Quantity"</span>] <span class="op">*</span> fact_modulation)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    ADV[<span class="st">"Quantity liquidated"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    quantity_liquidated_per_day <span class="op">=</span> [ADV[<span class="st">"Quantity"</span>]]</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    time_elapsed <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul des quantit√©s liquid√©es par jour</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (ADV[<span class="st">"Quantity"</span>] <span class="op">-</span> ADV[<span class="st">"Quantity liquidated"</span>]).<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span> :</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        liquidated_today <span class="op">=</span> np.minimum(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>            ADV[<span class="st">"Quantity in 1day"</span>], </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>            ADV[<span class="st">"Quantity"</span>] <span class="op">-</span> ADV[<span class="st">"Quantity liquidated"</span>]</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        ADV[<span class="st">"Quantity liquidated"</span>] <span class="op">+=</span> liquidated_today</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>        quantity_liquidated_per_day.append(liquidated_today)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        time_elapsed <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temps de liquidation du portefeuille : </span><span class="sc">{</span>time_elapsed<span class="sc">}</span><span class="ss"> jours"</span>)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Conversion des r√©sultats en DataFrame</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    liquidation_df <span class="op">=</span> pd.DataFrame(quantity_liquidated_per_day).T</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    liquidation_df.columns <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(quantity_liquidated_per_day))]</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la valeur liquide par actif et par jour</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    market_value <span class="op">=</span> [</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>        price_dict[ticker] <span class="op">*</span> liquidation_df.loc[ticker]</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ticker <span class="kw">in</span> selected_assets</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    market_value <span class="op">=</span> pd.DataFrame(market_value, index<span class="op">=</span>selected_assets, columns<span class="op">=</span>liquidation_df.columns)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---------------------------#</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul des poids par jour #</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---------------------------#</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    market_value_0 <span class="op">=</span> market_value.iloc[:, <span class="dv">0</span>]</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    total_market_value_0 <span class="op">=</span> market_value_0.<span class="bu">sum</span>()</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>    cumsum_market_value <span class="op">=</span> market_value.iloc[:, <span class="dv">1</span>:].cumsum(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    cumsum_total_market_value <span class="op">=</span> market_value.iloc[:, <span class="dv">1</span>:].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).cumsum()</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    cumsum_market_value <span class="op">=</span> pd.concat([pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>market_value.index, columns<span class="op">=</span>[<span class="dv">0</span>]), cumsum_market_value], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    cumsum_total_market_value <span class="op">=</span> pd.concat([pd.Series(<span class="dv">0</span>, index<span class="op">=</span>[<span class="dv">0</span>]), cumsum_total_market_value])</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> {}</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ticker <span class="kw">in</span> selected_assets :</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>        weights[ticker] <span class="op">=</span> (market_value_0.loc[ticker] <span class="op">-</span> cumsum_market_value.loc[ticker]) <span class="op">/</span> (total_market_value_0 <span class="op">-</span> cumsum_total_market_value)</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> pd.DataFrame(weights).T</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualisation des poids</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> plot_graphs:</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialiser le graphique</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Barplot empil√©</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>        bottom <span class="op">=</span> <span class="va">None</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> asset <span class="kw">in</span> weights.index:</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>            plt.bar(</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>                pd.to_numeric(weights.columns), </span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>                weights.loc[asset],  </span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>                bottom<span class="op">=</span>bottom, </span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span>selected_assets[asset]  </span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>            bottom <span class="op">=</span> weights.loc[asset] <span class="cf">if</span> bottom <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> bottom <span class="op">+</span> weights.loc[asset]</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">"Days of Liquidation"</span>)</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">"Portfolio Weights"</span>)</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">"D√©formation du portefeuille"</span>)</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>        plt.legend(title<span class="op">=</span><span class="st">"Assets"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">"upper left"</span>, fontsize<span class="op">=</span><span class="dv">8</span>, ncol<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---------------------------#</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   Profil de liquidation   #</span></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---------------------------#</span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>    market_value_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>    market_value_df[<span class="st">"market_value"</span>] <span class="op">=</span> market_value.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul des valeurs relatives et cumul√©es</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>    market_value_df[<span class="st">"relative value"</span>] <span class="op">=</span> market_value_df[<span class="st">"market_value"</span>] <span class="op">/</span> market_value_df[<span class="st">"market_value"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>    market_value_df[<span class="st">"cumulative value"</span>] <span class="op">=</span> market_value_df[<span class="st">"relative value"</span>].cumsum() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>    market_value_df <span class="op">=</span> market_value_df.iloc[<span class="dv">1</span>:]  <span class="co"># Retirer le jour 0 pour l'analyse cumul√©e</span></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualisation de la valeur cumulative (barplot)</span></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> plot_graphs:</span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> plt.bar(market_value_df.index, market_value_df[<span class="st">"cumulative value"</span>] <span class="op">*</span> <span class="dv">100</span>, color<span class="op">=</span><span class="st">"skyblue"</span>)</span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> bar.get_height()</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>            plt.text(</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>                bar.get_x() <span class="op">+</span> bar.get_width() <span class="op">/</span> <span class="dv">2</span>,  <span class="co"># Center text</span></span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>                height,  <span class="co"># Position slightly above the bar</span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>height<span class="sc">:.2f}</span><span class="ss">'</span>,  <span class="co"># Format with 2 decimal places</span></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>,  <span class="co"># Center horizontally</span></span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>                va<span class="op">=</span><span class="st">'bottom'</span>,  <span class="co"># Position text at the bottom</span></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">"Days"</span>)</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">"Cumulative Value (%)"</span>)</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">"Profil de liquidation du portefeuille"</span>)</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> market_value_df, market_value, weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous constatons qu‚Äôen utilisant un facteur de modulation de 0.3, le temps de liquidation est r√©duit √† 3 jours, ce qui est plus rapide que le temps de liquidation initial de 8 jours. Cela montre l‚Äôimpact significatif de la modulation sur le profil de liquidation du portefeuille.</p>
<div id="d27867a7" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fact_modulation<span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>new_market_value_df, new_market_value, new_weights <span class="op">=</span> waterfall_liquidation(ADV, price_dict, selected_assets, fact_modulation, plot_graphs<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 3 jours</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-17-output-2.png" width="945" height="374" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-17-output-3.png" width="816" height="378" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sous-conditions-stress√©es-avec-d√©formation" class="level3">
<h3 class="anchored" data-anchor-id="sous-conditions-stress√©es-avec-d√©formation">Sous conditions stress√©es avec d√©formation</h3>
<p>Pour stresser le portefeuille, √† la baisse, on va diviser la profondeur de march√© par 2. Cela signifie que l‚Äôon peut vendre moins d‚Äôactifs sans impacter le prix de mani√®re significative. En cons√©quence, le temps de liquidation augmente, car il faut plus de temps pour liquider la m√™me quantit√© d‚Äôactifs. Il est √©galement possible d‚Äôavoir des conditions stress√©es √† la hausse, o√π l‚Äôon multiplie la profondeur de march√© par 2. Cela signifie que l‚Äôon peut vendre plus d‚Äôactifs sans impacter le prix de mani√®re significative. En cons√©quence, le temps de liquidation diminue, car il faut moins de temps pour liquider la m√™me quantit√© d‚Äôactifs.</p>
<p>Dans notre cas, en stressant le portefeuille √† la baisse, nous constatons que le temps de liquidation augmente. On passe de 8 jours de liquidatin √† 15 jours.</p>
<div id="44705e69" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------#</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Stress Test</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------#</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ADV_stressed <span class="op">=</span> ADV.copy()</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantit√© journali√®re</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>market_depth <span class="op">=</span> (<span class="dv">20</span><span class="op">/</span><span class="dv">100</span>)<span class="op">/</span><span class="dv">2</span>  <span class="co"># On stresse la liquidit√© √† la baisse</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ADV_stressed[<span class="st">"Quantity in 1day"</span>] <span class="op">=</span> <span class="bu">round</span>(ADV_stressed[<span class="st">"ADV"</span>] <span class="op">*</span> market_depth)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul du nombre de jours de liquidation</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>ADV_stressed[<span class="st">"Days of liquidation"</span>] <span class="op">=</span> ADV_stressed[<span class="st">"Quantity"</span>]<span class="op">/</span>ADV_stressed[<span class="st">"Quantity in 1day"</span>]</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># floor to 1 and round</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>ADV_stressed[<span class="st">"Days of liquidation"</span>] <span class="op">=</span> ADV_stressed[<span class="st">"Days of liquidation"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">max</span>(<span class="dv">1</span>, <span class="bu">round</span>(x)))</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>time_elapsed <span class="op">=</span> ADV_stressed[<span class="st">'Days of liquidation'</span>].<span class="bu">max</span>()</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Temps de liquidation du portefeuille stress√©: </span><span class="sc">{</span>time_elapsed<span class="sc">}</span><span class="ss"> jours"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille stress√©: 15 jours</code></pre>
</div>
</div>
<div id="7a8c37d7" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>stressed_market_value_df, stressed_market_value, stressed_weights <span class="op">=</span> waterfall_liquidation(ADV<span class="op">=</span>ADV_stressed, price_dict<span class="op">=</span>price_dict, selected_assets<span class="op">=</span>selected_assets, fact_modulation<span class="op">=</span><span class="dv">1</span>, plot_graphs<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 15 jours</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-19-output-2.png" width="945" height="374" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-19-output-3.png" width="816" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="absence-de-d√©formation-du-portefeuille-pro-forma" class="level2">
<h2 class="anchored" data-anchor-id="absence-de-d√©formation-du-portefeuille-pro-forma">Absence de d√©formation du portefeuille (pro forma)</h2>
<p>Nous avons vu dans la section pr√©c√©dente que, lors de la liquidation d‚Äôun portefeuille, on a tendance √† commencer par les actifs les plus liquides. Cela conduit √† une concentration progressive d‚Äôactifs illiquides dans le portefeuille r√©siduel, ce qui peut affecter significativement sa valeur et accro√Ætre le risque de liquidit√©.</p>
<p>Dans cette section, nous allons √©tudier comment √©viter cette d√©formation en proc√©dant √† une liquidation proportionnelle : l‚Äôobjectif est de pr√©server la r√©partition initiale du portefeuille tout au long du processus de liquidation.</p>
<p>Pour cela, on commence par estimer, comme pr√©c√©demment, la quantit√© liquidable en un jour pour chaque titre. Cette estimation permet d‚Äôen d√©duire le pourcentage liquidable quotidien par rapport √† la position totale sur chaque actif. Si l‚Äôon souhaite que tous les titres soient liquid√©s √† la m√™me vitesse, il faut adopter le rythme de liquidation de l‚Äôactif le plus lent. Ainsi, on calcule le pourcentage liquidable en un jour pour chaque titre, puis on en retient le minimum. Ce minimum d√©finit alors le pourcentage quotidien de liquidation appliqu√© √† l‚Äôensemble du portefeuille. Ce proc√©d√© allonge la dur√©e totale de liquidation, mais il permet de conserver une structure de portefeuille stable. N√©anmoins, une l√©g√®re d√©formation peut subsister, notamment en raison des arrondis et des limites pratiques de liquidit√© sur certains actifs.</p>
<div id="36fe858d" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pro_forma_liquidation(ADV, price_dict, selected_assets, fact_modulation<span class="op">=</span><span class="fl">0.30</span>, plot_graphs<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Calcule le profil de liquidation pro forma et visualise les graphiques des poids et des valeurs cumul√©es.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    ADV <span class="op">=</span> ADV.copy()</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    ADV[<span class="st">"Quantity"</span>] <span class="op">=</span> ADV[<span class="st">"Quantity"</span>] <span class="op">*</span> fact_modulation</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    time_elapsed <span class="op">=</span> ADV[<span class="st">'Days of liquidation'</span>].<span class="bu">max</span>()</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    ADV[<span class="st">"Quantity liquidated"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    quantity_liquidated_per_day <span class="op">=</span> [ADV[<span class="st">"Quantity"</span>]]</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    min_liquidated_today <span class="op">=</span> np.ones(<span class="bu">len</span>(ADV[<span class="st">"Quantity"</span>]))</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    time_elapsed <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul des quantit√©s liquid√©es par jour</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> min_liquidated_today.<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>:  </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        liquidated_today <span class="op">=</span> np.minimum(</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>            ADV[<span class="st">"Quantity in 1day"</span>], </span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>            ADV[<span class="st">"Quantity"</span>] <span class="op">-</span> ADV[<span class="st">"Quantity liquidated"</span>]</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">/</span> ADV[<span class="st">"Quantity"</span>]</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>        min_liquidated_today <span class="op">=</span> <span class="bu">round</span>(np.<span class="bu">min</span>(liquidated_today) <span class="op">*</span> ADV[<span class="st">"Quantity"</span>])<span class="co"># On liquide √† la vitesse de l'actif le moins liquide</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>        ADV[<span class="st">"Quantity liquidated"</span>] <span class="op">+=</span> min_liquidated_today</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>        quantity_liquidated_per_day.append(min_liquidated_today)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>        time_elapsed <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temps de liquidation du portefeuille : </span><span class="sc">{</span>time_elapsed<span class="sc">}</span><span class="ss"> jours"</span>)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Conversion des r√©sultats en DataFrame</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    liquidation_df <span class="op">=</span> pd.DataFrame(quantity_liquidated_per_day).T</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    liquidation_df.columns <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(quantity_liquidated_per_day))]</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la valeur liquide par actif et par jour</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    market_value <span class="op">=</span> [</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>        price_dict[ticker] <span class="op">*</span> liquidation_df.loc[ticker]</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ticker <span class="kw">in</span> selected_assets</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    market_value <span class="op">=</span> pd.DataFrame(market_value, index<span class="op">=</span>selected_assets, columns<span class="op">=</span>liquidation_df.columns)</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---------------------------#</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul des poids par jour</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---------------------------#</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la valeur de march√© initiale et totale</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    market_value_0 <span class="op">=</span> market_value.iloc[:, <span class="dv">0</span>]</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    total_market_value_0 <span class="op">=</span> market_value_0.<span class="bu">sum</span>()</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>    cumsum_market_value <span class="op">=</span> market_value.iloc[:, <span class="dv">1</span>:].cumsum(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>    cumsum_total_market_value <span class="op">=</span> market_value.iloc[:, <span class="dv">1</span>:].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).cumsum()</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>    cumsum_market_value <span class="op">=</span> pd.concat([pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>market_value.index, columns<span class="op">=</span>[<span class="dv">0</span>]), cumsum_market_value], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    cumsum_total_market_value <span class="op">=</span> pd.concat([pd.Series(<span class="dv">0</span>, index<span class="op">=</span>[<span class="dv">0</span>]), cumsum_total_market_value])</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> {}</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ticker <span class="kw">in</span> selected_assets :</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>        weights[ticker] <span class="op">=</span> (market_value_0.loc[ticker] <span class="op">-</span> cumsum_market_value.loc[ticker]) <span class="op">/</span> (total_market_value_0 <span class="op">-</span> cumsum_total_market_value)</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> pd.DataFrame(weights).T</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> plot_graphs:</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>        bottom <span class="op">=</span> <span class="va">None</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> asset <span class="kw">in</span> weights.index:</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>            plt.bar(</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>                pd.to_numeric(weights.columns), </span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>                weights.loc[asset],  </span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>                bottom<span class="op">=</span>bottom, </span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span>selected_assets[asset]  </span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>            bottom <span class="op">=</span> weights.loc[asset] <span class="cf">if</span> bottom <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> bottom <span class="op">+</span> weights.loc[asset]</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">"Days of Liquidation"</span>)</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">"Portfolio Weights"</span>)</span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">"D√©formation du portefeuille"</span>)</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>        plt.legend(title<span class="op">=</span><span class="st">"Assets"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">"upper left"</span>, fontsize<span class="op">=</span><span class="dv">8</span>, ncol<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---------------------------#</span></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   Profil de liquidation   #</span></span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---------------------------#</span></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>    market_value_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>    market_value_df[<span class="st">"market_value"</span>] <span class="op">=</span> market_value.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul des valeurs relatives et cumul√©es</span></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>    market_value_df[<span class="st">"relative value"</span>] <span class="op">=</span> market_value_df[<span class="st">"market_value"</span>] <span class="op">/</span> market_value_df[<span class="st">"market_value"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>    market_value_df[<span class="st">"cumulative value"</span>] <span class="op">=</span> market_value_df[<span class="st">"relative value"</span>].cumsum() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>    market_value_df <span class="op">=</span> market_value_df.iloc[<span class="dv">1</span>:]  <span class="co"># Retirer le jour 0 pour l'analyse cumul√©e</span></span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualisation de la valeur cumulative (barplot)</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> plot_graphs:</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> plt.bar(market_value_df.index, market_value_df[<span class="st">"cumulative value"</span>] <span class="op">*</span> <span class="dv">100</span>, color<span class="op">=</span><span class="st">"skyblue"</span>)</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> bar.get_height()</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>            plt.text(</span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>                bar.get_x() <span class="op">+</span> bar.get_width() <span class="op">/</span> <span class="dv">2</span>,  <span class="co"># Center text</span></span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>                height,  <span class="co"># Position slightly above the bar</span></span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>height<span class="sc">:.2f}</span><span class="ss">'</span>,  <span class="co"># Format with 2 decimal places</span></span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>,  <span class="co"># Center horizontally</span></span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a>                va<span class="op">=</span><span class="st">'bottom'</span>,  <span class="co"># Position text at the bottom</span></span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">"Days"</span>)</span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">"Cumulative Value (%)"</span>)</span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">"Profil de liquidation du portefeuille"</span>)</span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> market_value_df, market_value, weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sous-condition-normale-sans-d√©formation" class="level3">
<h3 class="anchored" data-anchor-id="sous-condition-normale-sans-d√©formation">Sous condition normale sans d√©formation</h3>
<div id="919c1745" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>proforma_market_value_df, proforma_market_value, proforma_weights <span class="op">=</span> pro_forma_liquidation(ADV<span class="op">=</span>ADV, price_dict<span class="op">=</span>price_dict, selected_assets<span class="op">=</span>selected_assets, fact_modulation<span class="op">=</span><span class="dv">1</span>, plot_graphs<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 9 jours</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-21-output-2.png" width="945" height="374" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-21-output-3.png" width="816" height="378" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sous-conditions-stress√©es-sans-d√©formation" class="level3">
<h3 class="anchored" data-anchor-id="sous-conditions-stress√©es-sans-d√©formation">Sous conditions stress√©es sans d√©formation</h3>
<div id="19d50a58" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>proforma_s_market_value_df, proforma_s_market_value, proforma_s_weights <span class="op">=</span> pro_forma_liquidation(ADV<span class="op">=</span>ADV_stressed, price_dict<span class="op">=</span>price_dict, selected_assets<span class="op">=</span>selected_assets, fact_modulation<span class="op">=</span><span class="dv">1</span>, plot_graphs<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 16 jours</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-22-output-2.png" width="945" height="374" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TP-2_files/figure-html/cell-22-output-3.png" width="816" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>La liquidation d‚Äôun portefeuille est un exercice complexe qui n√©cessite de prendre en compte plusieurs facteurs : la liquidit√© des actifs, la taille du portefeuille, et les conditions de march√©. En utilisant des outils tels que le profil d‚Äô√©coulement (ou profil de liquidation), les investisseurs peuvent mieux anticiper l‚Äôimpact potentiel de leurs transactions sur les prix de march√©, et ainsi minimiser l‚Äôeffet de march√©.</p>
<p>Le processus de liquidation choisi peut conduire √† des rythmes de sortie diff√©rents, et il est essentiel d‚Äôen tenir compte dans la gestion active du portefeuille.</p>
<p>Pour pr√©server la liquidit√© d‚Äôun portefeuille, notamment en p√©riode de tension sur les march√©s, plusieurs m√©canismes r√©glementaires et op√©rationnels existent. Ils visent √† prot√©ger les investisseurs restants et √† maintenir la qualit√© du portefeuille. En cas de crise financi√®re ou de forte volatilit√©, les soci√©t√©s de gestion de portefeuille (SGP) peuvent activer ces dispositifs, conform√©ment aux dispositions pr√©vues par la r√©glementation.</p>
<p>Ces mesures permettent d‚Äô√©viter des ventes forc√©es d‚Äôactifs et de limiter les effets de contagion sur le reste du portefeuille.</p>
<p><strong>Principaux m√©canismes de gestion de la liquidit√© :</strong></p>
<ol type="1">
<li><p>Les gates (plafonnement de rachat)</p>
<p>Les gates permettent de limiter les rachats quotidiens √† un certain pourcentage de l‚Äôactif net du fonds. En g√©n√©ral, si les rachats d√©passent 5‚ÄØ% de l‚Äôactif net, la SGP a le droit (mais non l‚Äôobligation) de n‚Äôhonorer que les premiers 5‚ÄØ% et de reporter le reste sur les jours suivants, en fonction des conditions de march√©.</p>
<p>Ce m√©canisme permet de r√©duire l‚Äôimpact sur les prix de march√©, en √©vitant une vente massive d‚Äôactifs en un seul jour. C‚Äôest une mesure de protection des porteurs restants, bien que son activation soit souvent per√ßue comme un signal n√©gatif.</p>
<p>L‚Äôexistence du m√©canisme des gates doit figurer dans le prospectus du fonds, sauf justification sp√©cifique de la SGP. Il convient de noter que l‚Äôactivation des gates est optionnelle.</p></li>
<li><p><strong>La suspension des souscriptions et des rachats</strong></p>
<p>Il s‚Äôagit d‚Äôune mesure plus radicale, qui consiste √† geler temporairement les op√©rations d‚Äôentr√©e et de sortie du fonds. Elle est utilis√©e dans des situations exceptionnelles, telles que des crises de march√© ou une volatilit√© extr√™me, lorsque la valorisation des actifs devient incertaine ou que la liquidit√© dispara√Æt. Ce m√©canisme vise √† : pr√©server l‚Äô√©galit√© de traitement entre les investisseurs, √©viter des ventes pr√©cipit√©es d‚Äôactifs, stabiliser la structure du portefeuille. La suspension doit √™tre justifi√©e et temporaire, et elle est lev√©e d√®s que les conditions de march√© se normalisent.</p></li>
<li><p><strong>Les m√©canismes de d√©formation du portefeuille</strong></p>
<p>Il s‚Äôagit de mesures proactives consistant √† adapter la composition du portefeuille lors des rachats, pour pr√©server la liquidit√© r√©siduelle. Concr√®tement, la SGP peut choisir de vendre en priorit√© les actifs les plus liquides, ce qui permet de r√©pondre rapidement aux demandes de rachat sans impacter significativement les prix. Ces m√©canismes sont particuli√®rement utilis√©s en cas de rachats massifs, pour : limiter l‚Äôimpact de march√©, prot√©ger les investisseurs restants, √©viter une d√©stabilisation du portefeuille.</p>
<p>N√©anmoins, cela entra√Æne une d√©formation du portefeuille, c‚Äôest-√†-dire que les investisseurs qui restent se retrouvent avec une part moins liquide du portefeuille initial. Ce compromis doit √™tre g√©r√© avec prudence.</p></li>
</ol>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/cheryl-kdio\.github\.io\/personal-website\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>