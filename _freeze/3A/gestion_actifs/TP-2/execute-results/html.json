{
  "hash": "77a4b6e97a3744b314b840a89e3f108c",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Asset management : Risques de liquidit√© (profil d'√©coulement / de liquidation d‚Äôun portefeuille d‚Äôactifs)\"\nauthor : \n    - Cheryl Kouadio\n    - \"Sous la supervision de : Fai√ßal HIHI\"\njupyter: python3\ndate: \"2025-01-27\"\n---\n\n\nLe risque de liquidit√© est l‚Äôune des quatre grandes cat√©gories de risques auxquels une banque peut √™tre expos√©e. Il concerne √† la fois la liquidit√© du march√© et le risque op√©rationnel de financement.\n\n- La liquidit√© du march√© fait r√©f√©rence √† la capacit√© d‚Äôun investisseur √† acheter ou vendre un actif sans en affecter significativement le prix.\n- Le risque op√©rationnel de financement concerne la capacit√© √† lever des fonds pour financer ses activit√©s.\n\nAinsi, le risque de liquidit√© est crucial dans la gestion d‚Äôun portefeuille, notamment en p√©riode de tensions sur les march√©s. Si un investisseur doit liquider un actif, il peut √™tre contraint de le vendre √† un prix inf√©rieur √† sa valeur fondamentale, entra√Ænant ainsi une perte importante.\n\nPour √©valuer ce risque, plusieurs indicateurs sont utilis√©s :\n- le co√ªt de liquidit√©,\n- le profil d‚Äô√©coulement (ou profil de liquidation),\n- les gaps de liquidit√©,\n- les stress tests de liquidit√©.\n\nDans le cadre de notre √©tude, nous nous concentrons sur le profil d‚Äô√©coulement d‚Äôun portefeuille compos√© de 10 actifs, et ce dans les quatre sc√©narios suivants :\n\n**1. Conditions normales avec d√©formation :**\nOn consid√®re les volumes moyens de march√©, que l‚Äôon d√©forme pour obtenir les quantit√©s effectivement liquid√©es.  \nLa liquidation d√©bute avec les actifs les plus liquides et se termine avec les plus illiquides.  \nCe processus entra√Æne une d√©formation du portefeuille :  \nles premiers investisseurs r√©cup√®rent une part plus liquide, tandis que ceux qui restent se retrouvent avec des actifs plus illiquides.\n\n**2. Conditions normales sans d√©formation :**\nDans ce cas, on cherche √† pr√©server l‚Äô√©quilibre du portefeuille, afin de ne pas p√©naliser les investisseurs restants.  \nLa liquidation est r√©partie uniform√©ment, sans privil√©gier les actifs les plus liquides.\n\n**3. Conditions stress√©es avec d√©formation :**\nLes march√©s sont en tension, les volumes chutent drastiquement.  \nOn liquide en priorit√© les actifs les plus liquides, ce qui accentue l‚Äôilliquidit√© r√©siduelle du portefeuille.\n\n**4. Conditions stress√©es sans d√©formation :**\nM√™me en p√©riode de stress, on cherche √† conserver une proportionnalit√© √©quitable dans la liquidation, pour √©viter une concentration d‚Äôactifs illiquides pour les investisseurs restants.\n\n**√âtapes de mise en ≈ìuvre**\n\nPour chaque sc√©nario, on proc√®de selon les √©tapes suivantes :\n\n1. R√©cup√©ration des volumes journaliers sur une p√©riode historique de 3 mois, √† compter de la date d'aujourd'hui, i.e. le 28 mars 2025.\n2. Calcul de l‚ÄôADV sur 3 mois *(Average Daily Volume)* :  \n   $$\n   \\text{ADV}_{T=3M} = \\frac{1}{T} \\sum_{t=1}^{T} V_t,\n   $$\n\n   o√π $V_t$ est le volume quotidien et $T$ le nombre de jours ouvr√©s sur les 3 mois.\n\n3. G√©n√©ration des quantit√©s associ√©es √† chaque actif dans le portefeuille.\n4. Pour obtenir un portefeuille ni trop liquide, ni trop illiquide, on applique la formule :\n   $$\n   Q_i = 1.5 \\times \\text{randn}() \\times \\text{ADV}_{3M}^{(i)},\n   $$\n\n   o√π $\\text{randn}() \\sim \\mathcal{U}[0, 1]$ est une variable al√©atoire uniforme, et $\\text{ADV}_{3M}^{(i)}$ l‚ÄôADV de l‚Äôactif $i$.\n\n5. Calcul du profil de liquidation :\n   Ce profil est construit en fonction de la quantit√© liquid√©e chaque jour, en tenant compte de la limite fix√©e par le volume moyen quotidien de chaque actif.\n\nNous utiliserons un portefeuille fictif de 10 actifs du CAC, √† savoir :\n- Sanofi\n- Societe Generale\n- Thales\n- Engie\n- Capgemini\n- Carrefour\n- Orange\n- Accor\n- L'Oreal\n- Cr√©dit agricole\n\n\n### R√©cup√©ration des donn√©es\n\n::: {#891f1d13 .cell execution_count=2}\n``` {.python .cell-code}\n#------------------------------------#\n#---------- Package Imports ---------#\n#------------------------------------#\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nfrom datetime import datetime, timedelta\nimport yfinance as yf \nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n```\n:::\n\n\n::: {#83ff6db8 .cell execution_count=3}\n``` {.python .cell-code}\ndef get_data(start_date, end_date, index_ticker, tickers, column=\"Close\"):\n    \"\"\"\n    Extraction de prix de cl√¥ture d'actions\n    \"\"\"\n    # Extraction des volumes historiques des composants\n    data = yf.download(tickers, start=start_date, end=end_date, auto_adjust =True)[column]\n\n    # Extraction des volumes historiques de l'indice de ref√©rence\n    index = yf.download(index_ticker, start=start_date, end=end_date, auto_adjust =True)[column]\n\n    return {\n        \"portfolio_data\": data,\n        \"benchmark_data\": index,\n    }\n\nend_date = datetime.now()\nstart_date = end_date - timedelta(days=3*31)\n\nselected_assets = {\n    \"SAN.PA\" : \"Sanofi\",\n    \"GLE.PA\" : \"Soci√©t√© g√©n√©rale\",\n    \"HO.PA\" : \"Thales\",\n    \"ENGI.PA\" : \"Engie\",\n    \"CAP.PA\" : \"Capgemini\",\n    \"CA.PA\" : \"Carrefour\",\n    \"ORA.PA\" : \"Orange\",\n    \"AC.PA\" : \"Accor\",\n    \"OR.PA\" : \"L'Oreal\",\n    \"ACA.PA\" : \"Cr√©dit agricole\",\n    }\n\nindex = \"^FCHI\"\n\nassets_ticker  = list(selected_assets.keys())\n\ndata = get_data(start_date,end_date, index, assets_ticker, column=\"Volume\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\r[                       0%                       ]\r[                       0%                       ]\r[                       0%                       ]\r[                       0%                       ]\r[                       0%                       ]\r[                       0%                       ]\r[                       0%                       ]\r[**********************80%*************          ]  8 of 10 completed\r[**********************90%******************     ]  9 of 10 completed\r[*********************100%***********************]  10 of 10 completed\n\r[*********************100%***********************]  1 of 1 completed\n```\n:::\n:::\n\n\n::: {#b2223ffc .cell execution_count=4}\n``` {.python .cell-code}\nportfolio_data = data[\"portfolio_data\"]\nportfolio_data.tail()\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Ticker</th>\n      <th>AC.PA</th>\n      <th>ACA.PA</th>\n      <th>CA.PA</th>\n      <th>CAP.PA</th>\n      <th>ENGI.PA</th>\n      <th>GLE.PA</th>\n      <th>HO.PA</th>\n      <th>OR.PA</th>\n      <th>ORA.PA</th>\n      <th>SAN.PA</th>\n    </tr>\n    <tr>\n      <th>Date</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2025-03-24</th>\n      <td>730382</td>\n      <td>5071701</td>\n      <td>3617903</td>\n      <td>534016</td>\n      <td>5262159</td>\n      <td>2127625</td>\n      <td>371968</td>\n      <td>411521</td>\n      <td>7155931</td>\n      <td>1913393</td>\n    </tr>\n    <tr>\n      <th>2025-03-25</th>\n      <td>562409</td>\n      <td>6524905</td>\n      <td>2255242</td>\n      <td>558654</td>\n      <td>5809793</td>\n      <td>2587026</td>\n      <td>321188</td>\n      <td>353058</td>\n      <td>6643361</td>\n      <td>2079709</td>\n    </tr>\n    <tr>\n      <th>2025-03-26</th>\n      <td>655970</td>\n      <td>4275680</td>\n      <td>1989898</td>\n      <td>570364</td>\n      <td>5282143</td>\n      <td>2412206</td>\n      <td>300659</td>\n      <td>415637</td>\n      <td>7164082</td>\n      <td>2056619</td>\n    </tr>\n    <tr>\n      <th>2025-03-27</th>\n      <td>654205</td>\n      <td>4746013</td>\n      <td>2208609</td>\n      <td>560011</td>\n      <td>6384021</td>\n      <td>3124962</td>\n      <td>317644</td>\n      <td>371877</td>\n      <td>7035243</td>\n      <td>1645925</td>\n    </tr>\n    <tr>\n      <th>2025-03-28</th>\n      <td>973322</td>\n      <td>5792588</td>\n      <td>2671535</td>\n      <td>465431</td>\n      <td>5227544</td>\n      <td>2992606</td>\n      <td>298259</td>\n      <td>418671</td>\n      <td>5970202</td>\n      <td>2141022</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nL'Average Daily Volume (ADV) ou ATV (Average Traded Volume) est un indicateur cl√© en finance, qui permet de mesurer la liquidit√© d'un actif. Il est calcul√© en prenant la moyenne des volumes √©chang√©s sur une p√©riode donn√©e. Plus l'ADV est √©lev√©, plus l'actif est liquide, et plus il est facile de le vendre sans impacter le prix du march√©.\n\nEn g√©n√©ral, c'est l'ADV sur 3 mois qui est utilis√©, car il permet de lisser les variations quotidiennes et de donner une vision plus pr√©cise de la liquidit√© d'un actif. \n\n$$ADV = \\frac{\\sum_{i=1}^{n} V_i}{n},$$\n\no√π $V_i$ est le volume √©chang√© le jour $i$, et $n$ est le nombre de jours sur la p√©riode consid√©r√©e.\n\nDans le code ci-dessous, nous avons calcul√© l'ADV sur 3 mois pour chaque actif du portefeuille. Nous constatons que l'actif le plus liquide est **Orange**, avec un ADV d'environ 7,7 million d'actions √©chang√©es par jour, tandis que l'actif le moins liquide est **Thales**, avec un ADV d'environ 0,4 million d'actions √©chang√©es par jour. De ce fait, durant ces trois mois, l'action Orange a √©t√© plus plus liquide que l'action Thales.\n\n::: {#d863552d .cell execution_count=5}\n``` {.python .cell-code}\n#---------------------#\n# Calcul des ADV 3Mois#\n#---------------------#\n\nadv_3m = {ticker : np.mean(portfolio_data[ticker]) for ticker in assets_ticker}\nadv_3m\n\nADV = pd.DataFrame.from_dict(adv_3m, orient='index', columns=['ADV'])\n\n# trier par ADV\nADV.sort_values(by='ADV', ascending=False)\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ADV</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>ORA.PA</th>\n      <td>7.681298e+06</td>\n    </tr>\n    <tr>\n      <th>ACA.PA</th>\n      <td>6.942001e+06</td>\n    </tr>\n    <tr>\n      <th>ENGI.PA</th>\n      <td>6.072020e+06</td>\n    </tr>\n    <tr>\n      <th>GLE.PA</th>\n      <td>3.524290e+06</td>\n    </tr>\n    <tr>\n      <th>CA.PA</th>\n      <td>3.008415e+06</td>\n    </tr>\n    <tr>\n      <th>SAN.PA</th>\n      <td>1.827452e+06</td>\n    </tr>\n    <tr>\n      <th>AC.PA</th>\n      <td>6.501683e+05</td>\n    </tr>\n    <tr>\n      <th>CAP.PA</th>\n      <td>5.081382e+05</td>\n    </tr>\n    <tr>\n      <th>OR.PA</th>\n      <td>4.590586e+05</td>\n    </tr>\n    <tr>\n      <th>HO.PA</th>\n      <td>3.903374e+05</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nPour g√©n√©rer le volume d√©tenu dans notre portefeuille, nous allons utiliser la formule suivante :\n\n$$\n\\text{Volume d√©tenu} = 1.5 \\times \\text{randn()} \\times \\text{ADV 3M}\n$$\n\nCette formule sert √† simuler un portefeuille r√©aliste o√π les tailles de position sont ajust√©es √† la liquidit√© de chaque actif, avec une variabilit√© al√©atoire ma√Ætris√©e. Elle est simple, mais tr√®s utile pour tester des hypoth√®ses de liquidation, de stress, ou de concentration.\n\n::: {#630d1816 .cell execution_count=6}\n``` {.python .cell-code}\n# G√©n√©ration des quantit√©s\nnp.random.seed(123)\nADV[\"Quantity\"] =  round(1.5 * np.random.rand(len(ADV[\"ADV\"])) * ADV[\"ADV\"])\nADV\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ADV</th>\n      <th>Quantity</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>SAN.PA</th>\n      <td>1.827452e+06</td>\n      <td>1909146.0</td>\n    </tr>\n    <tr>\n      <th>GLE.PA</th>\n      <td>3.524290e+06</td>\n      <td>1512657.0</td>\n    </tr>\n    <tr>\n      <th>HO.PA</th>\n      <td>3.903374e+05</td>\n      <td>132823.0</td>\n    </tr>\n    <tr>\n      <th>ENGI.PA</th>\n      <td>6.072020e+06</td>\n      <td>5021391.0</td>\n    </tr>\n    <tr>\n      <th>CAP.PA</th>\n      <td>5.081382e+05</td>\n      <td>548385.0</td>\n    </tr>\n    <tr>\n      <th>CA.PA</th>\n      <td>3.008415e+06</td>\n      <td>1909319.0</td>\n    </tr>\n    <tr>\n      <th>ORA.PA</th>\n      <td>7.681298e+06</td>\n      <td>11300313.0</td>\n    </tr>\n    <tr>\n      <th>AC.PA</th>\n      <td>6.501683e+05</td>\n      <td>667882.0</td>\n    </tr>\n    <tr>\n      <th>OR.PA</th>\n      <td>4.590586e+05</td>\n      <td>331164.0</td>\n    </tr>\n    <tr>\n      <th>ACA.PA</th>\n      <td>6.942001e+06</td>\n      <td>4083121.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nEn plus de la g√©n√©ration des quantit√©s, il est utile de connaitre la quantit√© qu'on peut liquider en une journ√©e. En effet, la liquidit√© d'un actif n'est pas infinie, et il est important de savoir combien on peut vendre sans impacter le prix de mani√®re significative. Pour cela, on utilise la notion de profondeur de march√©.\n\nLa profondeur de march√© est une quantit√© √† partir de laquelle on ne peut plus vendre sans impacter le prix de fa√ßon consid√©rable. On fait l'hypoth√®se que la profondeur de march√© est de 20%. Cela signifie que l'on peut vendre 20% de la quantit√© sans impacter le prix de fa√ßon consid√©rable. Au-del√†, le prix est impact√©. Cette profondeur est ce qui est observ√© en pratique dans les carnets d'ordre √† tel point que l'AMF le recommande.\n\nA l'aide de cette profondeur de march√©, on peut d√©terminer la quantit√© liquidable en une journ√©e de la mani√®re suivante :\n$$\nADV 3M \\times 0.2\n$$\n\nLe nombre de jours de liquidation peut √™tre ainsi d√©termin√© :\n$$\n\\frac{\\text{Quantit√© √† liquider}}{\\text{Quantit√© liquidable en une journ√©e}}\n$$\n\nCe nombre de jours est g√©n√©ralement arrondi √† l'entier sup√©rieur et floor√© √† 1. Plus ce nombre est √©lev√©, plus la liquidation sera longue, et plus le risque de march√© sera √©lev√©. En effet, plus la liquidation est longue, plus le risque de march√© est √©lev√©, car il y a plus de chances que le prix de l'actif √©volue entre le moment o√π l'investisseur d√©cide de liquider et le moment o√π la liquidation est termin√©e.\n\n::: {#45282566 .cell execution_count=7}\n``` {.python .cell-code}\n# Quantit√© liquidable en 1 jour\nmarket_depth = 20/100\nADV[\"Quantity in 1day\"] = round(ADV[\"ADV\"] * market_depth)\n\n# Calcul du nombre de jours de liquidation\nADV[\"Days of liquidation\"] = ADV[\"Quantity\"]/ADV[\"Quantity in 1day\"]\n\n# floor to 1 and round\nADV[\"Days of liquidation\"] = ADV[\"Days of liquidation\"].apply(lambda x: max(1, round(x)))\nADV\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ADV</th>\n      <th>Quantity</th>\n      <th>Quantity in 1day</th>\n      <th>Days of liquidation</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>SAN.PA</th>\n      <td>1.827452e+06</td>\n      <td>1909146.0</td>\n      <td>365490.0</td>\n      <td>5</td>\n    </tr>\n    <tr>\n      <th>GLE.PA</th>\n      <td>3.524290e+06</td>\n      <td>1512657.0</td>\n      <td>704858.0</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>HO.PA</th>\n      <td>3.903374e+05</td>\n      <td>132823.0</td>\n      <td>78067.0</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>ENGI.PA</th>\n      <td>6.072020e+06</td>\n      <td>5021391.0</td>\n      <td>1214404.0</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>CAP.PA</th>\n      <td>5.081382e+05</td>\n      <td>548385.0</td>\n      <td>101628.0</td>\n      <td>5</td>\n    </tr>\n    <tr>\n      <th>CA.PA</th>\n      <td>3.008415e+06</td>\n      <td>1909319.0</td>\n      <td>601683.0</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>ORA.PA</th>\n      <td>7.681298e+06</td>\n      <td>11300313.0</td>\n      <td>1536260.0</td>\n      <td>7</td>\n    </tr>\n    <tr>\n      <th>AC.PA</th>\n      <td>6.501683e+05</td>\n      <td>667882.0</td>\n      <td>130034.0</td>\n      <td>5</td>\n    </tr>\n    <tr>\n      <th>OR.PA</th>\n      <td>4.590586e+05</td>\n      <td>331164.0</td>\n      <td>91812.0</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>ACA.PA</th>\n      <td>6.942001e+06</td>\n      <td>4083121.0</td>\n      <td>1388400.0</td>\n      <td>3</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#169715d6 .cell execution_count=8}\n``` {.python .cell-code}\ntime_elapsed = ADV['Days of liquidation'].max()\nprint(f\"Temps de liquidation du portefeuille : {time_elapsed} jours\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTemps de liquidation du portefeuille : 7 jours\n```\n:::\n:::\n\n\nEn calcucant le nombre de jours de liquidation pour chaque actif, on constate que les actifs qui se liquide le plus vite sont les actifs Thales et Soci√©t√© G√©n√©rale. L'actif qui quant √† lui prend le plus de temps √† se liquider est l'actif Orange. Cela peut sembler paradoxal, car Orange est l'actif le plus liquide,compte tenu de son ADV. Cependant, cela s'explique par le fait que la quantit√© √† liquider est d√©pendante de l'ADV, et est de ce fait tr√®s importante, et que la profondeur de march√© est faible. En effet, m√™me si l'ADV est √©lev√©, la profondeur de march√© est faible, ce qui rend la liquidation plus difficile. Un actif avec un petit ADV peut se liquider plus vite simplement parce qu'on lui aura affect√© d'un petit coefficient al√©atoire, dans la g√©n√©ration des quantit√©s initiales. \n\n> üí° La liquidit√© d'un portefeuille d√©pend de la liquidit√© intrins√®que des titres et la quantit√© de titres.\n\n## Pr√©sence de d√©formation\n\nLa d√©formation dans le cadre de la liquidation d'un portefeuille d'actifs fait r√©f√©rence √† la mani√®re dont les quantit√©s liquid√©es sont r√©parties entre les diff√©rents actifs du portefeuille. En effet, lorsque l'on liquide un portefeuille, on ne peut pas simplement vendre tous les actifs en m√™me temps, compte tenu de leur liquidit√© respective. La d√©formation se produit lorsque l'on liquide d'abord les actifs les plus liquides, ce qui entra√Æne une concentration d'actifs illiquides dans le portefeuille restant. Cela peut avoir un impact significatif sur la valeur du portefeuille et sur le risque de liquidit√©.\n\n### Sous conditions normales avec d√©formation (waterfall liquidation)\n\nPour conna√Ætre la quantit√© d'actifs liquid√©s chaque jour, on fait l'hypoth√®se que les liquidations futures se feront aux prix observ√©s aujourd'hui. En pratique, ce que l‚Äôon peut r√©ellement liquider en une journ√©e correspond √† la quantit√© que l‚Äôon peut vendre sans impacter le prix, c‚Äôest-√†-dire min(quantit√© liquidable en 1 jour, quantit√© restant dans le portefeuille).\n\nSur cette base, on peut calculer la valeur de march√© du portefeuille, aussi bien au moment initial qu'√† chaque jour de liquidation. Cette valeur est g√©n√©ralement exprim√©e en pourcentage de l'encours total.\n\nOn peut ensuite calculer le cumul des pourcentages liquid√©s au fil des jours. Cette courbe cumulative repr√©sente ce que l‚Äôon appelle le profil d‚Äô√©coulement du portefeuille.\n\nDans le code ci-dessous, nous pr√©sentons les quantit√©s liquid√©es par jour pour chaque actif.\n\n> üí° Par convention, le jour 0 correspond √† la quantit√© initialement d√©tenue dans le portefeuille, avant toute op√©ration de liquidation.\n\n::: {#dc38ecb7 .cell execution_count=9}\n``` {.python .cell-code}\n#---------------------------#\n# Liquidation du portefeuille\n#---------------------------#\n\nADV[\"Quantity liquidated\"] = 0  # Initialement, rien n'est liquid√©\n\n# Au jour 0, on a liquid√© 0. La colonne 0 sert de quantit√© initiale\nquantity_liquidated_per_day = [ADV[\"Quantity\"]]\n\nwhile (ADV[\"Quantity\"] - ADV[\"Quantity liquidated\"]).sum() > 0 : # Tant qu'il y a des liquidations √† faire\n    # Calculer la quantit√© liquide au jour i\n    liquidated_today = np.minimum(ADV[\"Quantity in 1day\"], ADV[\"Quantity\"] - ADV[\"Quantity liquidated\"])\n    \n    # Mettre √† jour les quantit√©s liquid√©es dans le DataFrame\n    ADV[\"Quantity liquidated\"] += liquidated_today\n    \n    # Stocker les quantit√©s liquid√©es ce jour dans une liste\n    quantity_liquidated_per_day.append(liquidated_today)\n\nliquidation_df = pd.DataFrame(quantity_liquidated_per_day).T\nliquidation_df.columns = [f\"{i}\" for i in range(len(quantity_liquidated_per_day))]\n\nliquidation_df\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>0</th>\n      <th>1</th>\n      <th>2</th>\n      <th>3</th>\n      <th>4</th>\n      <th>5</th>\n      <th>6</th>\n      <th>7</th>\n      <th>8</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>SAN.PA</th>\n      <td>1909146.0</td>\n      <td>365490.0</td>\n      <td>365490.0</td>\n      <td>365490.0</td>\n      <td>365490.0</td>\n      <td>365490.0</td>\n      <td>81696.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>GLE.PA</th>\n      <td>1512657.0</td>\n      <td>704858.0</td>\n      <td>704858.0</td>\n      <td>102941.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>HO.PA</th>\n      <td>132823.0</td>\n      <td>78067.0</td>\n      <td>54756.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>ENGI.PA</th>\n      <td>5021391.0</td>\n      <td>1214404.0</td>\n      <td>1214404.0</td>\n      <td>1214404.0</td>\n      <td>1214404.0</td>\n      <td>163775.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>CAP.PA</th>\n      <td>548385.0</td>\n      <td>101628.0</td>\n      <td>101628.0</td>\n      <td>101628.0</td>\n      <td>101628.0</td>\n      <td>101628.0</td>\n      <td>40245.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>CA.PA</th>\n      <td>1909319.0</td>\n      <td>601683.0</td>\n      <td>601683.0</td>\n      <td>601683.0</td>\n      <td>104270.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>ORA.PA</th>\n      <td>11300313.0</td>\n      <td>1536260.0</td>\n      <td>1536260.0</td>\n      <td>1536260.0</td>\n      <td>1536260.0</td>\n      <td>1536260.0</td>\n      <td>1536260.0</td>\n      <td>1536260.0</td>\n      <td>546493.0</td>\n    </tr>\n    <tr>\n      <th>AC.PA</th>\n      <td>667882.0</td>\n      <td>130034.0</td>\n      <td>130034.0</td>\n      <td>130034.0</td>\n      <td>130034.0</td>\n      <td>130034.0</td>\n      <td>17712.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>OR.PA</th>\n      <td>331164.0</td>\n      <td>91812.0</td>\n      <td>91812.0</td>\n      <td>91812.0</td>\n      <td>55728.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>ACA.PA</th>\n      <td>4083121.0</td>\n      <td>1388400.0</td>\n      <td>1388400.0</td>\n      <td>1306321.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#c8558629 .cell execution_count=10}\n``` {.python .cell-code}\nend_date = datetime.now()\nstart_date = end_date - timedelta(days=5)\nprice_data = get_data(start_date, end_date, index, assets_ticker, column=\"Close\")\n\nprice_data[\"portfolio_data\"].head()\nprice_dict = price_data[\"portfolio_data\"].iloc[-1].to_dict()\n\nprint(\"=\"*50)\nprint(\"Prix des actifs √† la date du jour\")\nprint(\"=\"*50)\nfor ticker, price in price_dict.items():\n    print(f\"Le prix de l'actif {selected_assets[ticker]} est de {price} ‚Ç¨\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\r[                       0%                       ]\r[**********            20%                       ]  2 of 10 completed\r[**************        30%                       ]  3 of 10 completed\r[*******************   40%                       ]  4 of 10 completed\r[**********************50%                       ]  5 of 10 completed\r[**********************50%                       ]  5 of 10 completed\r[**********************50%                       ]  5 of 10 completed\r[**********************80%*************          ]  8 of 10 completed\r[**********************80%*************          ]  8 of 10 completed\r[*********************100%***********************]  10 of 10 completed\n\r[*********************100%***********************]  1 of 1 completed\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n==================================================\nPrix des actifs √† la date du jour\n==================================================\nLe prix de l'actif Accor est de 42.790000915527344 ‚Ç¨\nLe prix de l'actif Cr√©dit agricole est de 16.94499969482422 ‚Ç¨\nLe prix de l'actif Carrefour est de 13.255000114440918 ‚Ç¨\nLe prix de l'actif Capgemini est de 145.3000030517578 ‚Ç¨\nLe prix de l'actif Engie est de 18.059999465942383 ‚Ç¨\nLe prix de l'actif Soci√©t√© g√©n√©rale est de 42.540000915527344 ‚Ç¨\nLe prix de l'actif Thales est de 246.60000610351562 ‚Ç¨\nLe prix de l'actif L'Oreal est de 345.1000061035156 ‚Ç¨\nLe prix de l'actif Orange est de 11.850000381469727 ‚Ç¨\nLe prix de l'actif Sanofi est de 103.4000015258789 ‚Ç¨\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\n```\n:::\n:::\n\n\n::: {#0d9f1a78 .cell execution_count=11}\n``` {.python .cell-code}\n# Valeur liquide des actions par jour de liquidation\nmarket_value =[\n    price_dict[ticker] * liquidation_df.loc[ticker]\n    for ticker in selected_assets\n]\n\nmarket_value = pd.DataFrame(market_value, index=selected_assets, columns=liquidation_df.columns)\nmarket_value\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>0</th>\n      <th>1</th>\n      <th>2</th>\n      <th>3</th>\n      <th>4</th>\n      <th>5</th>\n      <th>6</th>\n      <th>7</th>\n      <th>8</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>SAN.PA</th>\n      <td>1.974057e+08</td>\n      <td>3.779167e+07</td>\n      <td>3.779167e+07</td>\n      <td>3.779167e+07</td>\n      <td>3.779167e+07</td>\n      <td>3.779167e+07</td>\n      <td>8.447367e+06</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>GLE.PA</th>\n      <td>6.434843e+07</td>\n      <td>2.998466e+07</td>\n      <td>2.998466e+07</td>\n      <td>4.379110e+06</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>HO.PA</th>\n      <td>3.275415e+07</td>\n      <td>1.925132e+07</td>\n      <td>1.350283e+07</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>ENGI.PA</th>\n      <td>9.068632e+07</td>\n      <td>2.193214e+07</td>\n      <td>2.193214e+07</td>\n      <td>2.193214e+07</td>\n      <td>2.193214e+07</td>\n      <td>2.957776e+06</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>CAP.PA</th>\n      <td>7.968034e+07</td>\n      <td>1.476655e+07</td>\n      <td>1.476655e+07</td>\n      <td>1.476655e+07</td>\n      <td>1.476655e+07</td>\n      <td>1.476655e+07</td>\n      <td>5.847599e+06</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>CA.PA</th>\n      <td>2.530802e+07</td>\n      <td>7.975308e+06</td>\n      <td>7.975308e+06</td>\n      <td>7.975308e+06</td>\n      <td>1.382099e+06</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>ORA.PA</th>\n      <td>1.339087e+08</td>\n      <td>1.820468e+07</td>\n      <td>1.820468e+07</td>\n      <td>1.820468e+07</td>\n      <td>1.820468e+07</td>\n      <td>1.820468e+07</td>\n      <td>1.820468e+07</td>\n      <td>1.820468e+07</td>\n      <td>6.475942e+06</td>\n    </tr>\n    <tr>\n      <th>AC.PA</th>\n      <td>2.857867e+07</td>\n      <td>5.564155e+06</td>\n      <td>5.564155e+06</td>\n      <td>5.564155e+06</td>\n      <td>5.564155e+06</td>\n      <td>5.564155e+06</td>\n      <td>7.578965e+05</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>OR.PA</th>\n      <td>1.142847e+08</td>\n      <td>3.168432e+07</td>\n      <td>3.168432e+07</td>\n      <td>3.168432e+07</td>\n      <td>1.923173e+07</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>ACA.PA</th>\n      <td>6.918848e+07</td>\n      <td>2.352644e+07</td>\n      <td>2.352644e+07</td>\n      <td>2.213561e+07</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#940ab7af .cell execution_count=12}\n``` {.python .cell-code}\n# Calcul de la valeur de march√© initiale et totale\nmarket_value_0 = market_value.iloc[:, 0]\ntotal_market_value_0 = market_value_0.sum()\n\nprint(f\" La valeur de march√© initiale est de {total_market_value_0}‚Ç¨\")\n\n# Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)\ncumsum_market_value = market_value.iloc[:, 1:].cumsum(axis=1)\ncumsum_total_market_value = market_value.iloc[:, 1:].sum(axis=0).cumsum()\ncumsum_market_value = pd.concat([pd.DataFrame(0, index=market_value.index, columns=[0]), cumsum_market_value], axis=1)\ncumsum_total_market_value = pd.concat([pd.Series(0, index=[0]), cumsum_total_market_value])\n\nweights = {}\nfor ticker in assets_ticker :\n    weights[ticker] = (market_value_0.loc[ticker] - cumsum_market_value.loc[ticker]) / (total_market_value_0 - cumsum_total_market_value)\n\nweights = pd.DataFrame(weights).T\nweights.head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n La valeur de march√© initiale est de 836143533.8764086‚Ç¨\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>0</th>\n      <th>1</th>\n      <th>2</th>\n      <th>3</th>\n      <th>4</th>\n      <th>5</th>\n      <th>6</th>\n      <th>7</th>\n      <th>8</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>SAN.PA</th>\n      <td>0.236091</td>\n      <td>0.255194</td>\n      <td>0.289688</td>\n      <td>0.328122</td>\n      <td>0.336963</td>\n      <td>0.145800</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>GLE.PA</th>\n      <td>0.076959</td>\n      <td>0.054941</td>\n      <td>0.010413</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>HO.PA</th>\n      <td>0.039173</td>\n      <td>0.021589</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>ENGI.PA</th>\n      <td>0.108458</td>\n      <td>0.109925</td>\n      <td>0.111341</td>\n      <td>0.097190</td>\n      <td>0.021555</td>\n      <td>0.000000</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>CAP.PA</th>\n      <td>0.095295</td>\n      <td>0.103785</td>\n      <td>0.119248</td>\n      <td>0.138154</td>\n      <td>0.150224</td>\n      <td>0.100928</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#6d364d06 .cell execution_count=13}\n``` {.python .cell-code}\nplt.figure(figsize=(12, 6))\n\n# Barplot empil√©\nbottom = None\nfor asset in weights.index:\n    plt.bar(\n        pd.to_numeric(weights.columns),  \n        weights.loc[asset],  \n        bottom=bottom,  \n        label=selected_assets[asset]  \n    )\n    bottom = weights.loc[asset] if bottom is None else bottom + weights.loc[asset]\n\nplt.xlabel(\"Days of Liquidation\")\nplt.ylabel(\"Portfolio Weights\")\nplt.title(\"D√©formation du portefeuille\")\nplt.xticks(rotation=45)\nplt.legend(title=\"Assets\", bbox_to_anchor=(1.02, 1), loc=\"upper left\", fontsize=8, ncol=2)\nplt.tight_layout()\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-13-output-1.png){width=1138 height=566}\n:::\n:::\n\n\nNous constatons avec ce profile de liquidation que les actifs les plus liquides sont liquid√©s en premier, ce qui entra√Æne une concentration d'actifs illiquides dans le portefeuille restant. Cela peut avoir un impact significatif sur la valeur du portefeuille et sur le risque de liquidit√©. En effet, √† la fin de la p√©riode de liquidation, le portefeuille est uniquement constitu√© de l'actif Orange, qui nous avons vu pr√©c√©demment est l'actif le plus illiquide.\n\n<blockquote> \nüí° Bon √† savoir : Pour un fonds de droit fran√ßais r√©glement√©, il est interdit d‚Äôinvestir plus de 5‚ÄØ% du portefeuille dans un seul √©metteur.\nCependant, √† titre exceptionnel, il est possible d‚Äôinvestir jusqu‚Äô√† 10‚ÄØ% dans certains titres, √† condition que la somme des expositions sup√©rieures √† 5‚ÄØ% ne d√©passe pas 40‚ÄØ% du portefeuille.\nC‚Äôest ce que l‚Äôon appelle la r√®gle des 5/10/40, un ratio r√©glementaire applicable aux OPC (organismes de placement collectif).\nToutes les pertes li√©es √† un non-respect de ce ratio doivent √™tre support√©es par la soci√©t√© de gestion. De plus, tout d√©passement doit √™tre d√©clar√© √† l‚ÄôAMF.\n</blockquote> \n\n::: {#1e2a7006 .cell execution_count=14}\n``` {.python .cell-code}\n# Valeur liquide du portefeuille\nmarket_value_df = pd.DataFrame()\n\nmarket_value_df[\"market_value\"] = market_value.sum(axis=0)\n\n# Calculer la valeur liquide relative par rapport au jour 0\nmarket_value_df[\"relative value\"] = market_value_df[\"market_value\"] / market_value_df[\"market_value\"].iloc[0]\n\n# Calculer la valeur cumul√©e liquide relative du portefeuille\nmarket_value_df[\"cumulative value\"] = market_value_df[\"relative value\"].cumsum() - 1\n\nmarket_value_df\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>market_value</th>\n      <th>relative value</th>\n      <th>cumulative value</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>8.361435e+08</td>\n      <td>1.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2.106812e+08</td>\n      <td>0.251968</td>\n      <td>0.251968</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2.049327e+08</td>\n      <td>0.245093</td>\n      <td>0.497061</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1.644335e+08</td>\n      <td>0.196657</td>\n      <td>0.693718</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1.188730e+08</td>\n      <td>0.142168</td>\n      <td>0.835886</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>7.928483e+07</td>\n      <td>0.094822</td>\n      <td>0.930708</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>3.325754e+07</td>\n      <td>0.039775</td>\n      <td>0.970483</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>1.820468e+07</td>\n      <td>0.021772</td>\n      <td>0.992255</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>6.475942e+06</td>\n      <td>0.007745</td>\n      <td>1.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#70980370 .cell execution_count=15}\n``` {.python .cell-code}\nmarket_value_df = market_value_df.iloc[1:]\n\nplt.figure(figsize=(12, 6))\nbars = plt.bar(market_value_df.index, market_value_df[\"cumulative value\"] * 100, color=\"skyblue\")\n\nfor bar in bars:\n    height = bar.get_height()\n    plt.text(\n        bar.get_x() + bar.get_width() / 2,  # Center text\n        height,  # Position slightly above the bar\n        f'{height:.2f}',  # Format with 2 decimal places\n        ha='center',  # Center horizontally\n        va='bottom',  # Position text at the bottom\n        fontsize=10, color=\"black\"\n    )\n\nplt.xlabel(\"Days\")\nplt.ylabel(\"Cumulative Value (%)\")\nplt.title(\"Profil de liquidation du portefeuille\")\nplt.xticks(rotation=45)\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-15-output-1.png){width=965 height=526}\n:::\n:::\n\n\nPour voir ce qui arrive au profil d'√©coulement lorsque les quantit√©s varient, on va utiliser un facteur de modulation de la quantit√©. Cela permet de d√©terminer quelle est la taille cible du portefeuille qui permet d'avoir la liquidit√© pour un certain niveau en nombre de jours qu'on se fixe. Cet exercice est fait une seule fois √† l'initialisation du portefeuille.\n\nPour facilier l'impl√©mentation, nous allons utiliser une fonction `liquidation_profile` qui va nous permettre de calculer le profil d'√©coulement du portefeuille, en int√©grant le facteur de modulation. Lorsqu'on ne souhaite pas de modulation, on peut simplement passer un facteur de modulation de 1.\n\n::: {#87ca3ef2 .cell execution_count=16}\n``` {.python .cell-code}\ndef waterfall_liquidation(ADV, price_dict, selected_assets, fact_modulation=0.30, plot_graphs=True):\n    \"\"\"\n    Calcule le profil de liquidation et visualise les graphiques des poids et des valeurs cumul√©es.\n    \"\"\"\n    \n    # Initialisation des quantit√©s liquid√©es\n    ADV = ADV.copy()\n    ADV[\"Quantity\"] = round(ADV[\"Quantity\"] * fact_modulation)\n\n    ADV[\"Quantity liquidated\"] = 0\n    quantity_liquidated_per_day = [ADV[\"Quantity\"]]\n    \n    time_elapsed = 0 \n    # Calcul des quantit√©s liquid√©es par jour\n    while (ADV[\"Quantity\"] - ADV[\"Quantity liquidated\"]).sum() > 0 :\n        liquidated_today = np.minimum(\n            ADV[\"Quantity in 1day\"], \n            ADV[\"Quantity\"] - ADV[\"Quantity liquidated\"]\n        )\n        ADV[\"Quantity liquidated\"] += liquidated_today\n        quantity_liquidated_per_day.append(liquidated_today)\n        time_elapsed += 1\n    \n    print(f\"Temps de liquidation du portefeuille : {time_elapsed} jours\")\n    \n    # Conversion des r√©sultats en DataFrame\n    liquidation_df = pd.DataFrame(quantity_liquidated_per_day).T\n    liquidation_df.columns = [f\"{i}\" for i in range(len(quantity_liquidated_per_day))]\n    \n    # Calcul de la valeur liquide par actif et par jour\n    market_value = [\n        price_dict[ticker] * liquidation_df.loc[ticker]\n        for ticker in selected_assets\n    ]\n    market_value = pd.DataFrame(market_value, index=selected_assets, columns=liquidation_df.columns)\n    \n    #---------------------------#\n    # Calcul des poids par jour #\n    #---------------------------#\n\n    market_value_0 = market_value.iloc[:, 0]\n    total_market_value_0 = market_value_0.sum()\n\n    # Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)\n    cumsum_market_value = market_value.iloc[:, 1:].cumsum(axis=1)\n    cumsum_total_market_value = market_value.iloc[:, 1:].sum(axis=0).cumsum()\n    cumsum_market_value = pd.concat([pd.DataFrame(0, index=market_value.index, columns=[0]), cumsum_market_value], axis=1)\n    cumsum_total_market_value = pd.concat([pd.Series(0, index=[0]), cumsum_total_market_value])\n\n    weights = {}\n    for ticker in selected_assets :\n        weights[ticker] = (market_value_0.loc[ticker] - cumsum_market_value.loc[ticker]) / (total_market_value_0 - cumsum_total_market_value)\n\n    weights = pd.DataFrame(weights).T\n    \n    # Visualisation des poids\n    if plot_graphs:\n        # Initialiser le graphique\n        plt.figure(figsize=(10, 4))\n        \n\n        # Barplot empil√©\n        bottom = None\n        for asset in weights.index:\n            plt.bar(\n                pd.to_numeric(weights.columns), \n                weights.loc[asset],  \n                bottom=bottom, \n                label=selected_assets[asset]  \n            )\n            bottom = weights.loc[asset] if bottom is None else bottom + weights.loc[asset]\n\n        plt.xlabel(\"Days of Liquidation\")\n        plt.ylabel(\"Portfolio Weights\")\n        plt.title(\"D√©formation du portefeuille\")\n        plt.xticks(rotation=45)\n        plt.legend(title=\"Assets\", bbox_to_anchor=(1.02, 1), loc=\"upper left\", fontsize=8, ncol=2)\n        plt.tight_layout()\n\n        plt.show()\n\n    \n    #---------------------------#\n    #   Profil de liquidation   #\n    #---------------------------#\n\n    market_value_df = pd.DataFrame()\n    market_value_df[\"market_value\"] = market_value.sum(axis=0)\n    \n    # Calcul des valeurs relatives et cumul√©es\n    market_value_df[\"relative value\"] = market_value_df[\"market_value\"] / market_value_df[\"market_value\"].iloc[0]\n    market_value_df[\"cumulative value\"] = market_value_df[\"relative value\"].cumsum() - 1\n    market_value_df = market_value_df.iloc[1:]  # Retirer le jour 0 pour l'analyse cumul√©e\n    \n    # Visualisation de la valeur cumulative (barplot)\n    if plot_graphs:\n        plt.figure(figsize=(10, 4))\n        bars = plt.bar(market_value_df.index, market_value_df[\"cumulative value\"] * 100, color=\"skyblue\")\n        for bar in bars:\n            height = bar.get_height()\n            plt.text(\n                bar.get_x() + bar.get_width() / 2,  # Center text\n                height,  # Position slightly above the bar\n                f'{height:.2f}',  # Format with 2 decimal places\n                ha='center',  # Center horizontally\n                va='bottom',  # Position text at the bottom\n                fontsize=10, color=\"black\"\n            )\n        plt.xlabel(\"Days\")\n        plt.ylabel(\"Cumulative Value (%)\")\n        plt.title(\"Profil de liquidation du portefeuille\")\n        plt.xticks(rotation=45)\n        plt.show()\n\n    return market_value_df, market_value, weights\n```\n:::\n\n\nNous constatons qu'en utilisant un facteur de modulation de 0.3, le temps de liquidation est r√©duit √† 3 jours, ce qui est plus rapide que le temps de liquidation initial de 8 jours. Cela montre l'impact significatif de la modulation sur le profil de liquidation du portefeuille.\n\n::: {#d27867a7 .cell execution_count=17}\n``` {.python .cell-code}\nfact_modulation= 0.3\nnew_market_value_df, new_market_value, new_weights = waterfall_liquidation(ADV, price_dict, selected_assets, fact_modulation, plot_graphs=True)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTemps de liquidation du portefeuille : 3 jours\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-17-output-2.png){width=945 height=374}\n:::\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-17-output-3.png){width=816 height=378}\n:::\n:::\n\n\n### Sous conditions stress√©es avec d√©formation\n\nPour stresser le portefeuille, √† la baisse, on va diviser la profondeur de march√© par 2. Cela signifie que l'on peut vendre moins d'actifs sans impacter le prix de mani√®re significative. En cons√©quence, le temps de liquidation augmente, car il faut plus de temps pour liquider la m√™me quantit√© d'actifs. Il est √©galement possible d'avoir des conditions stress√©es √† la hausse, o√π l'on multiplie la profondeur de march√© par 2. Cela signifie que l'on peut vendre plus d'actifs sans impacter le prix de mani√®re significative. En cons√©quence, le temps de liquidation diminue, car il faut moins de temps pour liquider la m√™me quantit√© d'actifs.\n\nDans notre cas, en stressant le portefeuille √† la baisse, nous constatons que le temps de liquidation augmente. On passe de 8 jours de liquidatin √† 15 jours.\n\n::: {#44705e69 .cell execution_count=18}\n``` {.python .cell-code}\n#---------------------------#\n# Stress Test\n#---------------------------#\nADV_stressed = ADV.copy()\n\n# Quantit√© journali√®re\nmarket_depth = (20/100)/2  # On stresse la liquidit√© √† la baisse\nADV_stressed[\"Quantity in 1day\"] = round(ADV_stressed[\"ADV\"] * market_depth)\n\n# Calcul du nombre de jours de liquidation\nADV_stressed[\"Days of liquidation\"] = ADV_stressed[\"Quantity\"]/ADV_stressed[\"Quantity in 1day\"]\n\n# floor to 1 and round\nADV_stressed[\"Days of liquidation\"] = ADV_stressed[\"Days of liquidation\"].apply(lambda x: max(1, round(x)))\n\ntime_elapsed = ADV_stressed['Days of liquidation'].max()\nprint(f\"Temps de liquidation du portefeuille stress√©: {time_elapsed} jours\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTemps de liquidation du portefeuille stress√©: 15 jours\n```\n:::\n:::\n\n\n::: {#7a8c37d7 .cell execution_count=19}\n``` {.python .cell-code}\nstressed_market_value_df, stressed_market_value, stressed_weights = waterfall_liquidation(ADV=ADV_stressed, price_dict=price_dict, selected_assets=selected_assets, fact_modulation=1, plot_graphs=True)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTemps de liquidation du portefeuille : 15 jours\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-19-output-2.png){width=945 height=374}\n:::\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-19-output-3.png){width=816 height=384}\n:::\n:::\n\n\n## Absence de d√©formation du portefeuille (pro forma)\n\nNous avons vu dans la section pr√©c√©dente que, lors de la liquidation d‚Äôun portefeuille, on a tendance √† commencer par les actifs les plus liquides. Cela conduit √† une concentration progressive d‚Äôactifs illiquides dans le portefeuille r√©siduel, ce qui peut affecter significativement sa valeur et accro√Ætre le risque de liquidit√©.\n\nDans cette section, nous allons √©tudier comment √©viter cette d√©formation en proc√©dant √† une liquidation proportionnelle : l‚Äôobjectif est de pr√©server la r√©partition initiale du portefeuille tout au long du processus de liquidation.\n\nPour cela, on commence par estimer, comme pr√©c√©demment, la quantit√© liquidable en un jour pour chaque titre. Cette estimation permet d‚Äôen d√©duire le pourcentage liquidable quotidien par rapport √† la position totale sur chaque actif.\nSi l‚Äôon souhaite que tous les titres soient liquid√©s √† la m√™me vitesse, il faut adopter le rythme de liquidation de l‚Äôactif le plus lent. Ainsi, on calcule le pourcentage liquidable en un jour pour chaque titre, puis on en retient le minimum. Ce minimum d√©finit alors le pourcentage quotidien de liquidation appliqu√© √† l‚Äôensemble du portefeuille.\nCe proc√©d√© allonge la dur√©e totale de liquidation, mais il permet de conserver une structure de portefeuille stable. N√©anmoins, une l√©g√®re d√©formation peut subsister, notamment en raison des arrondis et des limites pratiques de liquidit√© sur certains actifs.\n\n::: {#36fe858d .cell execution_count=20}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\ndef pro_forma_liquidation(ADV, price_dict, selected_assets, fact_modulation=0.30, plot_graphs=True):\n    \"\"\"\n    Calcule le profil de liquidation pro forma et visualise les graphiques des poids et des valeurs cumul√©es.\n    \"\"\"\n\n    ADV = ADV.copy()\n    ADV[\"Quantity\"] = ADV[\"Quantity\"] * fact_modulation\n\n    time_elapsed = ADV['Days of liquidation'].max()\n\n    ADV[\"Quantity liquidated\"] = 0\n    quantity_liquidated_per_day = [ADV[\"Quantity\"]]\n    \n    min_liquidated_today = np.ones(len(ADV[\"Quantity\"]))\n    time_elapsed = 0 \n\n    # Calcul des quantit√©s liquid√©es par jour\n    while min_liquidated_today.sum() > 0:  \n\n        liquidated_today = np.minimum(\n            ADV[\"Quantity in 1day\"], \n            ADV[\"Quantity\"] - ADV[\"Quantity liquidated\"]\n        ) / ADV[\"Quantity\"]\n        min_liquidated_today = round(np.min(liquidated_today) * ADV[\"Quantity\"])# On liquide √† la vitesse de l'actif le moins liquide\n        ADV[\"Quantity liquidated\"] += min_liquidated_today\n        quantity_liquidated_per_day.append(min_liquidated_today)\n        time_elapsed += 1\n    \n    print(f\"Temps de liquidation du portefeuille : {time_elapsed} jours\")\n    \n    # Conversion des r√©sultats en DataFrame\n    liquidation_df = pd.DataFrame(quantity_liquidated_per_day).T\n    liquidation_df.columns = [f\"{i}\" for i in range(len(quantity_liquidated_per_day))]\n    \n    # Calcul de la valeur liquide par actif et par jour\n    market_value = [\n        price_dict[ticker] * liquidation_df.loc[ticker]\n        for ticker in selected_assets\n    ]\n    market_value = pd.DataFrame(market_value, index=selected_assets, columns=liquidation_df.columns)\n    \n    #---------------------------#\n    # Calcul des poids par jour\n    #---------------------------#\n\n    # Calcul de la valeur de march√© initiale et totale\n    market_value_0 = market_value.iloc[:, 0]\n    total_market_value_0 = market_value_0.sum()\n\n    # Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)\n    cumsum_market_value = market_value.iloc[:, 1:].cumsum(axis=1)\n    cumsum_total_market_value = market_value.iloc[:, 1:].sum(axis=0).cumsum()\n    cumsum_market_value = pd.concat([pd.DataFrame(0, index=market_value.index, columns=[0]), cumsum_market_value], axis=1)\n    cumsum_total_market_value = pd.concat([pd.Series(0, index=[0]), cumsum_total_market_value])\n    \n    weights = {}\n    for ticker in selected_assets :\n        weights[ticker] = (market_value_0.loc[ticker] - cumsum_market_value.loc[ticker]) / (total_market_value_0 - cumsum_total_market_value)\n\n    weights = pd.DataFrame(weights).T\n\n    if plot_graphs:\n        plt.figure(figsize=(10, 4))\n\n        bottom = None\n        for asset in weights.index:\n            plt.bar(\n                pd.to_numeric(weights.columns), \n                weights.loc[asset],  \n                bottom=bottom, \n                label=selected_assets[asset]  \n            )\n            bottom = weights.loc[asset] if bottom is None else bottom + weights.loc[asset]\n\n        plt.xlabel(\"Days of Liquidation\")\n        plt.ylabel(\"Portfolio Weights\")\n        plt.title(\"D√©formation du portefeuille\")\n        plt.xticks(rotation=45)\n        plt.legend(title=\"Assets\", bbox_to_anchor=(1.02, 1), loc=\"upper left\", fontsize=8, ncol=2)\n        plt.tight_layout()\n        plt.show()\n\n    \n    #---------------------------#\n    #   Profil de liquidation   #\n    #---------------------------#\n    \n    market_value_df = pd.DataFrame()\n    market_value_df[\"market_value\"] = market_value.sum(axis=0)\n    \n    # Calcul des valeurs relatives et cumul√©es\n    market_value_df[\"relative value\"] = market_value_df[\"market_value\"] / market_value_df[\"market_value\"].iloc[0]\n    market_value_df[\"cumulative value\"] = market_value_df[\"relative value\"].cumsum() - 1\n    market_value_df = market_value_df.iloc[1:]  # Retirer le jour 0 pour l'analyse cumul√©e\n    \n    # Visualisation de la valeur cumulative (barplot)\n    if plot_graphs:\n        plt.figure(figsize=(10, 4))\n        bars = plt.bar(market_value_df.index, market_value_df[\"cumulative value\"] * 100, color=\"skyblue\")\n        for bar in bars:\n            height = bar.get_height()\n            plt.text(\n                bar.get_x() + bar.get_width() / 2,  # Center text\n                height,  # Position slightly above the bar\n                f'{height:.2f}',  # Format with 2 decimal places\n                ha='center',  # Center horizontally\n                va='bottom',  # Position text at the bottom\n                fontsize=10, color=\"black\"\n            )\n        plt.xlabel(\"Days\")\n        plt.ylabel(\"Cumulative Value (%)\")\n        plt.title(\"Profil de liquidation du portefeuille\")\n        plt.xticks(rotation=45)\n        plt.show()\n    return market_value_df, market_value, weights\n```\n:::\n\n\n### Sous condition normale sans d√©formation\n\n::: {#919c1745 .cell execution_count=21}\n``` {.python .cell-code}\nproforma_market_value_df, proforma_market_value, proforma_weights = pro_forma_liquidation(ADV=ADV, price_dict=price_dict, selected_assets=selected_assets, fact_modulation=1, plot_graphs=True)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTemps de liquidation du portefeuille : 9 jours\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-21-output-2.png){width=945 height=374}\n:::\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-21-output-3.png){width=816 height=378}\n:::\n:::\n\n\n### Sous conditions stress√©es sans d√©formation\n\n::: {#19d50a58 .cell execution_count=22}\n``` {.python .cell-code}\nproforma_s_market_value_df, proforma_s_market_value, proforma_s_weights = pro_forma_liquidation(ADV=ADV_stressed, price_dict=price_dict, selected_assets=selected_assets, fact_modulation=1, plot_graphs=True)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTemps de liquidation du portefeuille : 16 jours\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-22-output-2.png){width=945 height=374}\n:::\n\n::: {.cell-output .cell-output-display}\n![](TP-2_files/figure-html/cell-22-output-3.png){width=816 height=384}\n:::\n:::\n\n\n## Conclusion\n\nLa liquidation d‚Äôun portefeuille est un exercice complexe qui n√©cessite de prendre en compte plusieurs facteurs : la liquidit√© des actifs, la taille du portefeuille, et les conditions de march√©. En utilisant des outils tels que le profil d‚Äô√©coulement (ou profil de liquidation), les investisseurs peuvent mieux anticiper l‚Äôimpact potentiel de leurs transactions sur les prix de march√©, et ainsi minimiser l‚Äôeffet de march√©.\n\nLe processus de liquidation choisi peut conduire √† des rythmes de sortie diff√©rents, et il est essentiel d‚Äôen tenir compte dans la gestion active du portefeuille.\n\nPour pr√©server la liquidit√© d‚Äôun portefeuille, notamment en p√©riode de tension sur les march√©s, plusieurs m√©canismes r√©glementaires et op√©rationnels existent. Ils visent √† prot√©ger les investisseurs restants et √† maintenir la qualit√© du portefeuille. En cas de crise financi√®re ou de forte volatilit√©, les soci√©t√©s de gestion de portefeuille (SGP) peuvent activer ces dispositifs, conform√©ment aux dispositions pr√©vues par la r√©glementation.\n\nCes mesures permettent d‚Äô√©viter des ventes forc√©es d‚Äôactifs et de limiter les effets de contagion sur le reste du portefeuille.\n\n**Principaux m√©canismes de gestion de la liquidit√© :**\n\n1. Les gates (plafonnement de rachat)\n\n    Les gates permettent de limiter les rachats quotidiens √† un certain pourcentage de l‚Äôactif net du fonds. En g√©n√©ral, si les rachats d√©passent 5‚ÄØ% de l‚Äôactif net, la SGP a le droit (mais non l‚Äôobligation) de n‚Äôhonorer que les premiers 5‚ÄØ% et de reporter le reste sur les jours suivants, en fonction des conditions de march√©.\n\n    Ce m√©canisme permet de r√©duire l‚Äôimpact sur les prix de march√©, en √©vitant une vente massive d‚Äôactifs en un seul jour.\n    C‚Äôest une mesure de protection des porteurs restants, bien que son activation soit souvent per√ßue comme un signal n√©gatif.\n\n    L‚Äôexistence du m√©canisme des gates doit figurer dans le prospectus du fonds, sauf justification sp√©cifique de la SGP. Il convient de noter que l‚Äôactivation des gates est optionnelle.\n\n2. **La suspension des souscriptions et des rachats**\n\n    Il s‚Äôagit d‚Äôune mesure plus radicale, qui consiste √† geler temporairement les op√©rations d‚Äôentr√©e et de sortie du fonds.\n    Elle est utilis√©e dans des situations exceptionnelles, telles que des crises de march√© ou une volatilit√© extr√™me, lorsque la valorisation des actifs devient incertaine ou que la liquidit√© dispara√Æt.\n    Ce m√©canisme vise √† : pr√©server l‚Äô√©galit√© de traitement entre les investisseurs, √©viter des ventes pr√©cipit√©es d‚Äôactifs, stabiliser la structure du portefeuille.\n    La suspension doit √™tre justifi√©e et temporaire, et elle est lev√©e d√®s que les conditions de march√© se normalisent.\n\n3. **Les m√©canismes de d√©formation du portefeuille**\n\n    Il s‚Äôagit de mesures proactives consistant √† adapter la composition du portefeuille lors des rachats, pour pr√©server la liquidit√© r√©siduelle.\n    Concr√®tement, la SGP peut choisir de vendre en priorit√© les actifs les plus liquides, ce qui permet de r√©pondre rapidement aux demandes de rachat sans impacter significativement les prix.\n    Ces m√©canismes sont particuli√®rement utilis√©s en cas de rachats massifs, pour : limiter l‚Äôimpact de march√©, prot√©ger les investisseurs restants, √©viter une d√©stabilisation du portefeuille.\n\n    N√©anmoins, cela entra√Æne une d√©formation du portefeuille, c‚Äôest-√†-dire que les investisseurs qui restent se retrouvent avec une part moins liquide du portefeuille initial. Ce compromis doit √™tre g√©r√© avec prudence.\n\n",
    "supporting": [
      "TP-2_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}